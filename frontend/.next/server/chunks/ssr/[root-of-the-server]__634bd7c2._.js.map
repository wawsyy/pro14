{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///D:/Cursor-Ku/demo14/pro14/frontend/fhevm/internal/constants.ts"],"sourcesContent":["export const SDK_CDN_URL =\r\n  \"https://cdn.zama.ai/relayer-sdk-js/0.2.0/relayer-sdk-js.umd.cjs\";\r\n\r\n"],"names":[],"mappings":";;;;AAAO,MAAM,cACX","debugId":null}},
    {"offset": {"line": 37, "column": 0}, "map": {"version":3,"sources":["file:///D:/Cursor-Ku/demo14/pro14/frontend/fhevm/internal/RelayerSDKLoader.ts"],"sourcesContent":["import { FhevmRelayerSDKType, FhevmWindowType } from \"./fhevmTypes\";\r\nimport { SDK_CDN_URL } from \"./constants\";\r\n\r\ntype TraceType = (message?: unknown, ...optionalParams: unknown[]) => void;\r\n\r\nexport class RelayerSDKLoader {\r\n  private _trace?: TraceType;\r\n\r\n  constructor(options: { trace?: TraceType }) {\r\n    this._trace = options.trace;\r\n  }\r\n\r\n  public isLoaded() {\r\n    if (typeof window === \"undefined\") {\r\n      throw new Error(\"RelayerSDKLoader: can only be used in the browser.\");\r\n    }\r\n    return isFhevmWindowType(window, this._trace);\r\n  }\r\n\r\n  public load(): Promise<void> {\r\n    console.log(\"[RelayerSDKLoader] load...\");\r\n    // Ensure this only runs in the browser\r\n    if (typeof window === \"undefined\") {\r\n      console.log(\"[RelayerSDKLoader] window === undefined\");\r\n      return Promise.reject(\r\n        new Error(\"RelayerSDKLoader: can only be used in the browser.\")\r\n      );\r\n    }\r\n\r\n    if (\"relayerSDK\" in window) {\r\n      if (!isFhevmRelayerSDKType(window.relayerSDK, this._trace)) {\r\n        console.log(\"[RelayerSDKLoader] window.relayerSDK === undefined\");\r\n        throw new Error(\"RelayerSDKLoader: Unable to load FHEVM Relayer SDK\");\r\n      }\r\n      return Promise.resolve();\r\n    }\r\n\r\n    return new Promise((resolve, reject) => {\r\n      const existingScript = document.querySelector(\r\n        `script[src=\"${SDK_CDN_URL}\"]`\r\n      );\r\n      if (existingScript) {\r\n        if (!isFhevmWindowType(window, this._trace)) {\r\n          reject(\r\n            new Error(\r\n              \"RelayerSDKLoader: window object does not contain a valid relayerSDK object.\"\r\n            )\r\n          );\r\n        }\r\n        resolve();\r\n        return;\r\n      }\r\n\r\n      const script = document.createElement(\"script\");\r\n      script.src = SDK_CDN_URL;\r\n      script.type = \"text/javascript\";\r\n      script.async = true;\r\n\r\n      script.onload = () => {\r\n        if (!isFhevmWindowType(window, this._trace)) {\r\n          console.log(\"[RelayerSDKLoader] script onload FAILED...\");\r\n          reject(\r\n            new Error(\r\n              `RelayerSDKLoader: Relayer SDK script has been successfully loaded from ${SDK_CDN_URL}, however, the window.relayerSDK object is invalid.`\r\n            )\r\n          );\r\n        }\r\n        resolve();\r\n      };\r\n\r\n      script.onerror = () => {\r\n        console.log(\"[RelayerSDKLoader] script onerror... \");\r\n        reject(\r\n          new Error(\r\n            `RelayerSDKLoader: Failed to load Relayer SDK from ${SDK_CDN_URL}`\r\n          )\r\n        );\r\n      };\r\n\r\n      console.log(\"[RelayerSDKLoader] add script to DOM...\");\r\n      document.head.appendChild(script);\r\n      console.log(\"[RelayerSDKLoader] script added!\")\r\n    });\r\n  }\r\n}\r\n\r\nfunction isFhevmRelayerSDKType(\r\n  o: unknown,\r\n  trace?: TraceType\r\n): o is FhevmRelayerSDKType {\r\n  if (typeof o === \"undefined\") {\r\n    trace?.(\"RelayerSDKLoader: relayerSDK is undefined\");\r\n    return false;\r\n  }\r\n  if (o === null) {\r\n    trace?.(\"RelayerSDKLoader: relayerSDK is null\");\r\n    return false;\r\n  }\r\n  if (typeof o !== \"object\") {\r\n    trace?.(\"RelayerSDKLoader: relayerSDK is not an object\");\r\n    return false;\r\n  }\r\n  if (!objHasProperty(o, \"initSDK\", \"function\", trace)) {\r\n    trace?.(\"RelayerSDKLoader: relayerSDK.initSDK is invalid\");\r\n    return false;\r\n  }\r\n  if (!objHasProperty(o, \"createInstance\", \"function\", trace)) {\r\n    trace?.(\"RelayerSDKLoader: relayerSDK.createInstance is invalid\");\r\n    return false;\r\n  }\r\n  if (!objHasProperty(o, \"SepoliaConfig\", \"object\", trace)) {\r\n    trace?.(\"RelayerSDKLoader: relayerSDK.SepoliaConfig is invalid\");\r\n    return false;\r\n  }\r\n  if (\"__initialized__\" in o) {\r\n    if (o.__initialized__ !== true && o.__initialized__ !== false) {\r\n      trace?.(\"RelayerSDKLoader: relayerSDK.__initialized__ is invalid\");\r\n      return false;\r\n    }\r\n  }\r\n  return true;\r\n}\r\n\r\nexport function isFhevmWindowType(\r\n  win: unknown,\r\n  trace?: TraceType\r\n): win is FhevmWindowType {\r\n  if (typeof win === \"undefined\") {\r\n    trace?.(\"RelayerSDKLoader: window object is undefined\");\r\n    return false;\r\n  }\r\n  if (win === null) {\r\n    trace?.(\"RelayerSDKLoader: window object is null\");\r\n    return false;\r\n  }\r\n  if (typeof win !== \"object\") {\r\n    trace?.(\"RelayerSDKLoader: window is not an object\");\r\n    return false;\r\n  }\r\n  if (!(\"relayerSDK\" in win)) {\r\n    trace?.(\"RelayerSDKLoader: window does not contain 'relayerSDK' property\");\r\n    return false;\r\n  }\r\n  return isFhevmRelayerSDKType(win.relayerSDK);\r\n}\r\n\r\nfunction objHasProperty<\r\n  T extends object,\r\n  K extends PropertyKey,\r\n  V extends string // \"string\", \"number\", etc.\r\n>(\r\n  obj: T,\r\n  propertyName: K,\r\n  propertyType: V,\r\n  trace?: TraceType\r\n): obj is T &\r\n  Record<\r\n    K,\r\n    V extends \"string\"\r\n      ? string\r\n      : V extends \"number\"\r\n      ? number\r\n      : V extends \"object\"\r\n      ? object\r\n      : V extends \"boolean\"\r\n      ? boolean\r\n      : V extends \"function\"\r\n      ? // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n        (...args: any[]) => any\r\n      : unknown\r\n  > {\r\n  if (!obj || typeof obj !== \"object\") {\r\n    return false;\r\n  }\r\n\r\n  if (!(propertyName in obj)) {\r\n    trace?.(`RelayerSDKLoader: missing ${String(propertyName)}.`);\r\n    return false;\r\n  }\r\n\r\n  const value = (obj as Record<K, unknown>)[propertyName];\r\n\r\n  if (value === null || value === undefined) {\r\n    trace?.(`RelayerSDKLoader: ${String(propertyName)} is null or undefined.`);\r\n    return false;\r\n  }\r\n\r\n  if (typeof value !== propertyType) {\r\n    trace?.(\r\n      `RelayerSDKLoader: ${String(propertyName)} is not a ${propertyType}.`\r\n    );\r\n    return false;\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;;AACA;;AAIO,MAAM;IACH,OAAmB;IAE3B,YAAY,OAA8B,CAAE;QAC1C,IAAI,CAAC,MAAM,GAAG,QAAQ,KAAK;IAC7B;IAEO,WAAW;QAChB,wCAAmC;YACjC,MAAM,IAAI,MAAM;QAClB;QACA,OAAO,kBAAkB,QAAQ,IAAI,CAAC,MAAM;IAC9C;IAEO,OAAsB;QAC3B,QAAQ,GAAG,CAAC;QACZ,uCAAuC;QACvC,wCAAmC;YACjC,QAAQ,GAAG,CAAC;YACZ,OAAO,QAAQ,MAAM,CACnB,IAAI,MAAM;QAEd;;;IAwDF;AACF;AAEA,SAAS,sBACP,CAAU,EACV,KAAiB;IAEjB,IAAI,OAAO,MAAM,aAAa;QAC5B,QAAQ;QACR,OAAO;IACT;IACA,IAAI,MAAM,MAAM;QACd,QAAQ;QACR,OAAO;IACT;IACA,IAAI,OAAO,MAAM,UAAU;QACzB,QAAQ;QACR,OAAO;IACT;IACA,IAAI,CAAC,eAAe,GAAG,WAAW,YAAY,QAAQ;QACpD,QAAQ;QACR,OAAO;IACT;IACA,IAAI,CAAC,eAAe,GAAG,kBAAkB,YAAY,QAAQ;QAC3D,QAAQ;QACR,OAAO;IACT;IACA,IAAI,CAAC,eAAe,GAAG,iBAAiB,UAAU,QAAQ;QACxD,QAAQ;QACR,OAAO;IACT;IACA,IAAI,qBAAqB,GAAG;QAC1B,IAAI,EAAE,eAAe,KAAK,QAAQ,EAAE,eAAe,KAAK,OAAO;YAC7D,QAAQ;YACR,OAAO;QACT;IACF;IACA,OAAO;AACT;AAEO,SAAS,kBACd,GAAY,EACZ,KAAiB;IAEjB,IAAI,OAAO,QAAQ,aAAa;QAC9B,QAAQ;QACR,OAAO;IACT;IACA,IAAI,QAAQ,MAAM;QAChB,QAAQ;QACR,OAAO;IACT;IACA,IAAI,OAAO,QAAQ,UAAU;QAC3B,QAAQ;QACR,OAAO;IACT;IACA,IAAI,CAAC,CAAC,gBAAgB,GAAG,GAAG;QAC1B,QAAQ;QACR,OAAO;IACT;IACA,OAAO,sBAAsB,IAAI,UAAU;AAC7C;AAEA,SAAS,eAKP,GAAM,EACN,YAAe,EACf,YAAe,EACf,KAAiB;IAiBjB,IAAI,CAAC,OAAO,OAAO,QAAQ,UAAU;QACnC,OAAO;IACT;IAEA,IAAI,CAAC,CAAC,gBAAgB,GAAG,GAAG;QAC1B,QAAQ,CAAC,0BAA0B,EAAE,OAAO,cAAc,CAAC,CAAC;QAC5D,OAAO;IACT;IAEA,MAAM,QAAQ,AAAC,GAA0B,CAAC,aAAa;IAEvD,IAAI,UAAU,QAAQ,UAAU,WAAW;QACzC,QAAQ,CAAC,kBAAkB,EAAE,OAAO,cAAc,sBAAsB,CAAC;QACzE,OAAO;IACT;IAEA,IAAI,OAAO,UAAU,cAAc;QACjC,QACE,CAAC,kBAAkB,EAAE,OAAO,cAAc,UAAU,EAAE,aAAa,CAAC,CAAC;QAEvE,OAAO;IACT;IAEA,OAAO;AACT","debugId":null}},
    {"offset": {"line": 142, "column": 0}, "map": {"version":3,"sources":["file:///D:/Cursor-Ku/demo14/pro14/frontend/fhevm/internal/PublicKeyStorage.ts"],"sourcesContent":["import { openDB, DBSchema, IDBPDatabase } from \"idb\";\r\n\r\ntype FhevmStoredPublicKey = {\r\n  publicKeyId: string;\r\n  publicKey: Uint8Array;\r\n};\r\n\r\ntype FhevmStoredPublicParams = {\r\n  publicParamsId: string;\r\n  publicParams: Uint8Array;\r\n};\r\n\r\ninterface PublicParamsDB extends DBSchema {\r\n  publicKeyStore: {\r\n    key: string;\r\n    value: {\r\n      acl: `0x${string}`;\r\n      value: FhevmStoredPublicKey;\r\n    };\r\n  };\r\n  paramsStore: {\r\n    key: string;\r\n    value: {\r\n      acl: `0x${string}`;\r\n      value: FhevmStoredPublicParams;\r\n    };\r\n  };\r\n}\r\n\r\nlet __dbPromise: Promise<IDBPDatabase<PublicParamsDB>> | undefined = undefined;\r\n\r\nasync function _getDB(): Promise<IDBPDatabase<PublicParamsDB> | undefined> {\r\n  if (__dbPromise) {\r\n    return __dbPromise;\r\n  }\r\n  if (typeof window === \"undefined\") {\r\n    return undefined;\r\n  }\r\n  __dbPromise = openDB<PublicParamsDB>(\"fhevm\", 1, {\r\n    upgrade(db) {\r\n      if (!db.objectStoreNames.contains(\"paramsStore\")) {\r\n        db.createObjectStore(\"paramsStore\", { keyPath: \"acl\" });\r\n      }\r\n      if (!db.objectStoreNames.contains(\"publicKeyStore\")) {\r\n        db.createObjectStore(\"publicKeyStore\", { keyPath: \"acl\" });\r\n      }\r\n    },\r\n  });\r\n  return __dbPromise;\r\n}\r\n\r\ntype FhevmInstanceConfigPublicKey = {\r\n  data: Uint8Array | null;\r\n  id: string | null;\r\n};\r\n\r\ntype FhevmInstanceConfigPublicParams = {\r\n  \"2048\": {\r\n    publicParamsId: string;\r\n    publicParams: Uint8Array;\r\n  };\r\n};\r\n\r\nfunction assertFhevmStoredPublicKey(\r\n  value: unknown\r\n): asserts value is FhevmStoredPublicKey | null {\r\n  if (typeof value !== \"object\") {\r\n    throw new Error(`FhevmStoredPublicKey must be an object`);\r\n  }\r\n  if (value === null) {\r\n    return;\r\n  }\r\n  if (!(\"publicKeyId\" in value)) {\r\n    throw new Error(`FhevmStoredPublicKey.publicKeyId does not exist`);\r\n  }\r\n  if (typeof value.publicKeyId !== \"string\") {\r\n    throw new Error(`FhevmStoredPublicKey.publicKeyId must be a string`);\r\n  }\r\n  if (!(\"publicKey\" in value)) {\r\n    throw new Error(`FhevmStoredPublicKey.publicKey does not exist`);\r\n  }\r\n  if (!(value.publicKey instanceof Uint8Array)) {\r\n    throw new Error(`FhevmStoredPublicKey.publicKey must be a Uint8Array`);\r\n  }\r\n}\r\n\r\nfunction assertFhevmStoredPublicParams(\r\n  value: unknown\r\n): asserts value is FhevmStoredPublicParams | null {\r\n  if (typeof value !== \"object\") {\r\n    throw new Error(`FhevmStoredPublicParams must be an object`);\r\n  }\r\n  if (value === null) {\r\n    return;\r\n  }\r\n  if (!(\"publicParamsId\" in value)) {\r\n    throw new Error(`FhevmStoredPublicParams.publicParamsId does not exist`);\r\n  }\r\n  if (typeof value.publicParamsId !== \"string\") {\r\n    throw new Error(`FhevmStoredPublicParams.publicParamsId must be a string`);\r\n  }\r\n  if (!(\"publicParams\" in value)) {\r\n    throw new Error(`FhevmStoredPublicParams.publicParams does not exist`);\r\n  }\r\n  if (!(value.publicParams instanceof Uint8Array)) {\r\n    throw new Error(\r\n      `FhevmStoredPublicParams.publicParams must be a Uint8Array`\r\n    );\r\n  }\r\n}\r\n\r\nexport async function publicKeyStorageGet(aclAddress: `0x${string}`): Promise<{\r\n  publicKey?: FhevmInstanceConfigPublicKey;\r\n  publicParams: FhevmInstanceConfigPublicParams | null;\r\n}> {\r\n  const db = await _getDB();\r\n  if (!db) {\r\n    return { publicParams: null };\r\n  }\r\n\r\n  let storedPublicKey: FhevmStoredPublicKey | null = null;\r\n  try {\r\n    const pk = await db.get(\"publicKeyStore\", aclAddress);\r\n    if (pk?.value) {\r\n      assertFhevmStoredPublicKey(pk.value);\r\n      storedPublicKey = pk.value;\r\n    }\r\n  } catch {\r\n    //\r\n  }\r\n\r\n  let storedPublicParams: FhevmStoredPublicParams | null = null;\r\n  try {\r\n    const pp = await db.get(\"paramsStore\", aclAddress);\r\n    if (pp?.value) {\r\n      assertFhevmStoredPublicParams(pp.value);\r\n      storedPublicParams = pp.value;\r\n    }\r\n  } catch {\r\n    //\r\n  }\r\n\r\n  const publicKeyData = storedPublicKey?.publicKey;\r\n  const publicKeyId = storedPublicKey?.publicKeyId;\r\n  const publicParams = storedPublicParams\r\n    ? {\r\n        \"2048\": storedPublicParams,\r\n      }\r\n    : null;\r\n\r\n  let publicKey: FhevmInstanceConfigPublicKey | undefined = undefined;\r\n\r\n  if (publicKeyId && publicKeyData) {\r\n    publicKey = {\r\n      id: publicKeyId,\r\n      data: publicKeyData,\r\n    };\r\n  }\r\n\r\n  return {\r\n    ...(publicKey !== undefined && { publicKey }),\r\n    publicParams,\r\n  };\r\n}\r\n\r\nexport async function publicKeyStorageSet(\r\n  aclAddress: `0x${string}`,\r\n  publicKey: FhevmStoredPublicKey | null,\r\n  publicParams: FhevmStoredPublicParams | null\r\n) {\r\n  assertFhevmStoredPublicKey(publicKey);\r\n  assertFhevmStoredPublicParams(publicParams);\r\n\r\n  const db = await _getDB();\r\n  if (!db) {\r\n    return;\r\n  }\r\n\r\n  if (publicKey) {\r\n    await db.put(\"publicKeyStore\", { acl: aclAddress, value: publicKey });\r\n  }\r\n\r\n  if (publicParams) {\r\n    await db.put(\"paramsStore\", { acl: aclAddress, value: publicParams });\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;;AAAA;;AA6BA,IAAI,cAAiE;AAErE,eAAe;IACb,IAAI,aAAa;QACf,OAAO;IACT;IACA,wCAAmC;QACjC,OAAO;IACT;;;AAYF;AAcA,SAAS,2BACP,KAAc;IAEd,IAAI,OAAO,UAAU,UAAU;QAC7B,MAAM,IAAI,MAAM,CAAC,sCAAsC,CAAC;IAC1D;IACA,IAAI,UAAU,MAAM;QAClB;IACF;IACA,IAAI,CAAC,CAAC,iBAAiB,KAAK,GAAG;QAC7B,MAAM,IAAI,MAAM,CAAC,+CAA+C,CAAC;IACnE;IACA,IAAI,OAAO,MAAM,WAAW,KAAK,UAAU;QACzC,MAAM,IAAI,MAAM,CAAC,iDAAiD,CAAC;IACrE;IACA,IAAI,CAAC,CAAC,eAAe,KAAK,GAAG;QAC3B,MAAM,IAAI,MAAM,CAAC,6CAA6C,CAAC;IACjE;IACA,IAAI,CAAC,CAAC,MAAM,SAAS,YAAY,UAAU,GAAG;QAC5C,MAAM,IAAI,MAAM,CAAC,mDAAmD,CAAC;IACvE;AACF;AAEA,SAAS,8BACP,KAAc;IAEd,IAAI,OAAO,UAAU,UAAU;QAC7B,MAAM,IAAI,MAAM,CAAC,yCAAyC,CAAC;IAC7D;IACA,IAAI,UAAU,MAAM;QAClB;IACF;IACA,IAAI,CAAC,CAAC,oBAAoB,KAAK,GAAG;QAChC,MAAM,IAAI,MAAM,CAAC,qDAAqD,CAAC;IACzE;IACA,IAAI,OAAO,MAAM,cAAc,KAAK,UAAU;QAC5C,MAAM,IAAI,MAAM,CAAC,uDAAuD,CAAC;IAC3E;IACA,IAAI,CAAC,CAAC,kBAAkB,KAAK,GAAG;QAC9B,MAAM,IAAI,MAAM,CAAC,mDAAmD,CAAC;IACvE;IACA,IAAI,CAAC,CAAC,MAAM,YAAY,YAAY,UAAU,GAAG;QAC/C,MAAM,IAAI,MACR,CAAC,yDAAyD,CAAC;IAE/D;AACF;AAEO,eAAe,oBAAoB,UAAyB;IAIjE,MAAM,KAAK,MAAM;IACjB,IAAI,CAAC,IAAI;QACP,OAAO;YAAE,cAAc;QAAK;IAC9B;IAEA,IAAI,kBAA+C;IACnD,IAAI;QACF,MAAM,KAAK,MAAM,GAAG,GAAG,CAAC,kBAAkB;QAC1C,IAAI,IAAI,OAAO;YACb,2BAA2B,GAAG,KAAK;YACnC,kBAAkB,GAAG,KAAK;QAC5B;IACF,EAAE,OAAM;IACN,EAAE;IACJ;IAEA,IAAI,qBAAqD;IACzD,IAAI;QACF,MAAM,KAAK,MAAM,GAAG,GAAG,CAAC,eAAe;QACvC,IAAI,IAAI,OAAO;YACb,8BAA8B,GAAG,KAAK;YACtC,qBAAqB,GAAG,KAAK;QAC/B;IACF,EAAE,OAAM;IACN,EAAE;IACJ;IAEA,MAAM,gBAAgB,iBAAiB;IACvC,MAAM,cAAc,iBAAiB;IACrC,MAAM,eAAe,qBACjB;QACE,QAAQ;IACV,IACA;IAEJ,IAAI,YAAsD;IAE1D,IAAI,eAAe,eAAe;QAChC,YAAY;YACV,IAAI;YACJ,MAAM;QACR;IACF;IAEA,OAAO;QACL,GAAI,cAAc,aAAa;YAAE;QAAU,CAAC;QAC5C;IACF;AACF;AAEO,eAAe,oBACpB,UAAyB,EACzB,SAAsC,EACtC,YAA4C;IAE5C,2BAA2B;IAC3B,8BAA8B;IAE9B,MAAM,KAAK,MAAM;IACjB,IAAI,CAAC,IAAI;QACP;IACF;IAEA,IAAI,WAAW;QACb,MAAM,GAAG,GAAG,CAAC,kBAAkB;YAAE,KAAK;YAAY,OAAO;QAAU;IACrE;IAEA,IAAI,cAAc;QAChB,MAAM,GAAG,GAAG,CAAC,eAAe;YAAE,KAAK;YAAY,OAAO;QAAa;IACrE;AACF","debugId":null}},
    {"offset": {"line": 271, "column": 0}, "map": {"version":3,"sources":["file:///D:/Cursor-Ku/demo14/pro14/frontend/fhevm/internal/fhevm.ts"],"sourcesContent":["import { isAddress, Eip1193Provider, JsonRpcProvider } from \"ethers\";\r\nimport type {\r\n  FhevmInitSDKOptions,\r\n  FhevmInitSDKType,\r\n  FhevmLoadSDKType,\r\n  FhevmWindowType,\r\n} from \"./fhevmTypes\";\r\nimport { isFhevmWindowType, RelayerSDKLoader } from \"./RelayerSDKLoader\";\r\nimport { publicKeyStorageGet, publicKeyStorageSet } from \"./PublicKeyStorage\";\r\nimport { FhevmInstance, FhevmInstanceConfig } from \"../fhevmTypes\";\r\n\r\nexport class FhevmReactError extends Error {\r\n  code: string;\r\n  constructor(code: string, message?: string, options?: ErrorOptions) {\r\n    super(message, options);\r\n    this.code = code;\r\n    this.name = \"FhevmReactError\";\r\n  }\r\n}\r\n\r\nfunction throwFhevmError(\r\n  code: string,\r\n  message?: string,\r\n  cause?: unknown\r\n): never {\r\n  throw new FhevmReactError(code, message, cause ? { cause } : undefined);\r\n}\r\n\r\nconst isFhevmInitialized = (): boolean => {\r\n  if (!isFhevmWindowType(window, console.log)) {\r\n    return false;\r\n  }\r\n  return window.relayerSDK.__initialized__ === true;\r\n};\r\n\r\nconst fhevmLoadSDK: FhevmLoadSDKType = () => {\r\n  const loader = new RelayerSDKLoader({ trace: console.log });\r\n  return loader.load();\r\n};\r\n\r\nconst fhevmInitSDK: FhevmInitSDKType = async (\r\n  options?: FhevmInitSDKOptions\r\n) => {\r\n  if (!isFhevmWindowType(window, console.log)) {\r\n    throw new Error(\"window.relayerSDK is not available\");\r\n  }\r\n  const result = await window.relayerSDK.initSDK(options);\r\n  window.relayerSDK.__initialized__ = result;\r\n  if (!result) {\r\n    throw new Error(\"window.relayerSDK.initSDK failed.\");\r\n  }\r\n  return true;\r\n};\r\n\r\nfunction checkIsAddress(a: unknown): a is `0x${string}` {\r\n  if (typeof a !== \"string\") {\r\n    return false;\r\n  }\r\n  if (!isAddress(a)) {\r\n    return false;\r\n  }\r\n  return true;\r\n}\r\n\r\nexport class FhevmAbortError extends Error {\r\n  constructor(message = \"FHEVM operation was cancelled\") {\r\n    super(message);\r\n    this.name = \"FhevmAbortError\";\r\n  }\r\n}\r\n\r\ntype FhevmRelayerStatusType =\r\n  | \"sdk-loading\"\r\n  | \"sdk-loaded\"\r\n  | \"sdk-initializing\"\r\n  | \"sdk-initialized\"\r\n  | \"creating\";\r\n\r\nasync function getChainId(\r\n  providerOrUrl: Eip1193Provider | string\r\n): Promise<number> {\r\n  if (typeof providerOrUrl === \"string\") {\r\n    const provider = new JsonRpcProvider(providerOrUrl);\r\n    return Number((await provider.getNetwork()).chainId);\r\n  }\r\n  const chainId = await providerOrUrl.request({ method: \"eth_chainId\" });\r\n  return Number.parseInt(chainId as string, 16);\r\n}\r\n\r\nasync function getWeb3Client(rpcUrl: string) {\r\n  const rpc = new JsonRpcProvider(rpcUrl);\r\n  try {\r\n    const version = await rpc.send(\"web3_clientVersion\", []);\r\n    return version;\r\n  } catch (e) {\r\n    throwFhevmError(\r\n      \"WEB3_CLIENTVERSION_ERROR\",\r\n      `The URL ${rpcUrl} is not a Web3 node or is not reachable. Please check the endpoint.`,\r\n      e\r\n    );\r\n  } finally {\r\n    rpc.destroy();\r\n  }\r\n}\r\n\r\nasync function tryFetchFHEVMHardhatNodeRelayerMetadata(rpcUrl: string): Promise<\r\n  | {\r\n      ACLAddress: `0x${string}`;\r\n      InputVerifierAddress: `0x${string}`;\r\n      KMSVerifierAddress: `0x${string}`;\r\n    }\r\n  | undefined\r\n> {\r\n  const version = await getWeb3Client(rpcUrl);\r\n  if (\r\n    typeof version !== \"string\" ||\r\n    !version.toLowerCase().includes(\"hardhat\")\r\n  ) {\r\n    // Not a Hardhat Node\r\n    return undefined;\r\n  }\r\n  try {\r\n    const metadata = await getFHEVMRelayerMetadata(rpcUrl);\r\n    if (!metadata || typeof metadata !== \"object\") {\r\n      return undefined;\r\n    }\r\n    if (\r\n      !(\r\n        \"ACLAddress\" in metadata &&\r\n        typeof metadata.ACLAddress === \"string\" &&\r\n        metadata.ACLAddress.startsWith(\"0x\")\r\n      )\r\n    ) {\r\n      return undefined;\r\n    }\r\n    if (\r\n      !(\r\n        \"InputVerifierAddress\" in metadata &&\r\n        typeof metadata.InputVerifierAddress === \"string\" &&\r\n        metadata.InputVerifierAddress.startsWith(\"0x\")\r\n      )\r\n    ) {\r\n      return undefined;\r\n    }\r\n    if (\r\n      !(\r\n        \"KMSVerifierAddress\" in metadata &&\r\n        typeof metadata.KMSVerifierAddress === \"string\" &&\r\n        metadata.KMSVerifierAddress.startsWith(\"0x\")\r\n      )\r\n    ) {\r\n      return undefined;\r\n    }\r\n    return metadata;\r\n  } catch {\r\n    // Not a FHEVM Hardhat Node\r\n    return undefined;\r\n  }\r\n}\r\n\r\nasync function getFHEVMRelayerMetadata(rpcUrl: string) {\r\n  const rpc = new JsonRpcProvider(rpcUrl);\r\n  try {\r\n    const version = await rpc.send(\"fhevm_relayer_metadata\", []);\r\n    return version;\r\n  } catch (e) {\r\n    throwFhevmError(\r\n      \"FHEVM_RELAYER_METADATA_ERROR\",\r\n      `The URL ${rpcUrl} is not a FHEVM Hardhat node or is not reachable. Please check the endpoint.`,\r\n      e\r\n    );\r\n  } finally {\r\n    rpc.destroy();\r\n  }\r\n}\r\n\r\ntype MockResolveResult = { isMock: true; chainId: number; rpcUrl: string };\r\ntype GenericResolveResult = { isMock: false; chainId: number; rpcUrl?: string };\r\ntype ResolveResult = MockResolveResult | GenericResolveResult;\r\n\r\nasync function resolve(\r\n  providerOrUrl: Eip1193Provider | string,\r\n  mockChains?: Record<number, string>\r\n): Promise<ResolveResult> {\r\n  // Resolve chainId\r\n  const chainId = await getChainId(providerOrUrl);\r\n\r\n  // Resolve rpc url\r\n  let rpcUrl = typeof providerOrUrl === \"string\" ? providerOrUrl : undefined;\r\n\r\n  const _mockChains: Record<number, string> = {\r\n    31337: \"http://localhost:8545\",\r\n    ...(mockChains ?? {}),\r\n  };\r\n\r\n  // Help Typescript solver here:\r\n  if (Object.hasOwn(_mockChains, chainId)) {\r\n    if (!rpcUrl) {\r\n      rpcUrl = _mockChains[chainId];\r\n    }\r\n\r\n    return { isMock: true, chainId, rpcUrl };\r\n  }\r\n\r\n  return { isMock: false, chainId, rpcUrl };\r\n}\r\n\r\nexport const createFhevmInstance = async (parameters: {\r\n  provider: Eip1193Provider | string;\r\n  mockChains?: Record<number, string>;\r\n  signal: AbortSignal;\r\n  onStatusChange?: (status: FhevmRelayerStatusType) => void;\r\n}): Promise<FhevmInstance> => {\r\n  const throwIfAborted = () => {\r\n    if (signal.aborted) throw new FhevmAbortError();\r\n  };\r\n\r\n  const notify = (status: FhevmRelayerStatusType) => {\r\n    if (onStatusChange) onStatusChange(status);\r\n  };\r\n\r\n  const {\r\n    signal,\r\n    onStatusChange,\r\n    provider: providerOrUrl,\r\n    mockChains,\r\n  } = parameters;\r\n\r\n  // Resolve chainId\r\n  const { isMock, rpcUrl, chainId } = await resolve(providerOrUrl, mockChains);\r\n\r\n  if (isMock) {\r\n    // Throws an error if cannot connect or url does not refer to a Web3 client\r\n    const fhevmRelayerMetadata =\r\n      await tryFetchFHEVMHardhatNodeRelayerMetadata(rpcUrl);\r\n\r\n    if (fhevmRelayerMetadata) {\r\n      // fhevmRelayerMetadata is defined, which means rpcUrl refers to a FHEVM Hardhat Node\r\n      notify(\"creating\");\r\n\r\n      //////////////////////////////////////////////////////////////////////////\r\n      // \r\n      // WARNING!!\r\n      // ALWAY USE DYNAMIC IMPORT TO AVOID INCLUDING THE ENTIRE FHEVM MOCK LIB \r\n      // IN THE FINAL PRODUCTION BUNDLE!!\r\n      // \r\n      //////////////////////////////////////////////////////////////////////////\r\n      const fhevmMock = await import(\"./mock/fhevmMock\");\r\n      const mockInstance = await fhevmMock.fhevmMockCreateInstance({\r\n        rpcUrl,\r\n        chainId,\r\n        metadata: fhevmRelayerMetadata,\r\n      });\r\n\r\n      throwIfAborted();\r\n\r\n      return mockInstance;\r\n    }\r\n  }\r\n\r\n  throwIfAborted();\r\n\r\n  if (!isFhevmWindowType(window, console.log)) {\r\n    notify(\"sdk-loading\");\r\n\r\n    // throws an error if failed\r\n    await fhevmLoadSDK();\r\n    throwIfAborted();\r\n\r\n    notify(\"sdk-loaded\");\r\n  }\r\n\r\n  // notify that state === \"sdk-loaded\"\r\n\r\n  if (!isFhevmInitialized()) {\r\n    notify(\"sdk-initializing\");\r\n\r\n    // throws an error if failed\r\n    await fhevmInitSDK();\r\n    throwIfAborted();\r\n\r\n    notify(\"sdk-initialized\");\r\n  }\r\n\r\n  const relayerSDK = (window as unknown as FhevmWindowType).relayerSDK;\r\n\r\n  const aclAddress = relayerSDK.SepoliaConfig.aclContractAddress;\r\n  if (!checkIsAddress(aclAddress)) {\r\n    throw new Error(`Invalid address: ${aclAddress}`);\r\n  }\r\n\r\n  const pub = await publicKeyStorageGet(aclAddress);\r\n  throwIfAborted();\r\n\r\n  const config: FhevmInstanceConfig = {\r\n    ...relayerSDK.SepoliaConfig,\r\n    network: providerOrUrl,\r\n    publicKey: pub.publicKey,\r\n    publicParams: pub.publicParams,\r\n  };\r\n\r\n  // notify that state === \"creating\"\r\n  notify(\"creating\");\r\n\r\n  const instance = await relayerSDK.createInstance(config);\r\n\r\n  // Save the key even if aborted\r\n  await publicKeyStorageSet(\r\n    aclAddress,\r\n    instance.getPublicKey(),\r\n    instance.getPublicParams(2048)\r\n  );\r\n\r\n  throwIfAborted();\r\n\r\n  return instance;\r\n};\r\n\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 495, "column": 0}, "map": {"version":3,"sources":["file:///D:/Cursor-Ku/demo14/pro14/frontend/fhevm/useFhevm.tsx"],"sourcesContent":["import { ethers } from \"ethers\";\nimport { useCallback, useEffect, useRef, useState } from \"react\";\nimport type { FhevmInstance } from \"./fhevmTypes\";\nimport { createFhevmInstance } from \"./internal/fhevm\";\n\nfunction _assert(condition: boolean, message?: string): asserts condition {\n  if (!condition) {\n    const m = message ? `Assertion failed: ${message}` : `Assertion failed.`;\n    console.error(m);\n    throw new Error(m);\n  }\n}\n\nexport type FhevmGoState = \"idle\" | \"loading\" | \"ready\" | \"error\";\n\nexport function useFhevm(parameters: {\n  provider: string | ethers.Eip1193Provider | undefined;\n  chainId: number | undefined;\n  enabled?: boolean;\n  initialMockChains?: Readonly<Record<number, string>>;  \n}): {\n  instance: FhevmInstance | undefined;\n  refresh: () => void;\n  error: Error | undefined;\n  status: FhevmGoState;\n} {\n  const { provider, chainId, initialMockChains, enabled = true } = parameters;\n\n  const [instance, _setInstance] = useState<FhevmInstance | undefined>(\n    undefined\n  );\n  const [status, _setStatus] = useState<FhevmGoState>(\"idle\");\n  const [error, _setError] = useState<Error | undefined>(undefined);\n  const [_isRunning, _setIsRunning] = useState<boolean>(enabled);\n  const [_providerChanged, _setProviderChanged] = useState<number>(0);\n  const _abortControllerRef = useRef<AbortController | null>(null);\n  const _providerRef = useRef<string | ethers.Eip1193Provider | undefined>(\n    provider\n  );\n  const _chainIdRef = useRef<number | undefined>(chainId);\n  const _mockChainsRef = useRef<Record<number, string> | undefined>(\n    initialMockChains\n  );\n\n  const refresh = useCallback(() => {\n    // Provider or chainId has changed. Abort immediately\n    if (_abortControllerRef.current) {\n      // Make sure _providerRef.current + _chainIdRef.current are undefined during abort\n      _providerRef.current = undefined;\n      _chainIdRef.current = undefined;\n\n      _abortControllerRef.current.abort();\n      _abortControllerRef.current = null;\n    }\n\n    _providerRef.current = provider;\n    _chainIdRef.current = chainId;\n\n    // Nullify instance immediately\n    _setInstance(undefined);\n    _setError(undefined);\n    _setStatus(\"idle\");\n\n    if (provider !== undefined) {\n      // Force call main useEffect\n      _setProviderChanged((prev) => prev + 1);\n    }\n\n    // Do not modify the running flag.\n  }, [provider, chainId]);\n\n  // Merge in main useEffect!!!\n  useEffect(() => {\n    refresh();\n  }, [refresh]);\n\n  useEffect(() => {\n    _setIsRunning(enabled);\n  }, [enabled]);\n\n  // Main useEffect\n  useEffect(() => {\n    // is _providerRef.current valid here ?\n    // even if the first useEffect is rendered in the same render-cycle ?\n    if (_isRunning === false) {\n      // cancelled\n      console.log(\"cancelled\");\n      if (_abortControllerRef.current) {\n        _abortControllerRef.current.abort();\n        _abortControllerRef.current = null;\n      }\n      // May already be null if provider was changed in the previous render-cycle\n      _setInstance(undefined);\n      _setError(undefined);\n      _setStatus(\"idle\");\n      return;\n    }\n\n    if (_isRunning === true) {\n      if (_providerRef.current === undefined) {\n        // instance should be undefined\n        // this code below should be unecessary\n        _setInstance(undefined);\n        _setError(undefined);\n        _setStatus(\"idle\");\n        return;\n      }\n\n      if (!_abortControllerRef.current) {\n        _abortControllerRef.current = new AbortController();\n      }\n\n      _assert(\n        !_abortControllerRef.current.signal.aborted,\n        \"!controllerRef.current.signal.aborted\"\n      );\n\n      // Keep old instance\n      // Was set to undefined if provider changed\n      _setStatus(\"loading\");\n      _setError(undefined);\n\n      const thisSignal = _abortControllerRef.current.signal;\n      const thisProvider = _providerRef.current;\n      // Can be undefined, if so, call eth_chainId\n      const thisRpcUrlsByChainId = _mockChainsRef.current;\n\n      createFhevmInstance({\n        signal: thisSignal,\n        provider: thisProvider,\n        mockChains: thisRpcUrlsByChainId,\n        onStatusChange: (s) =>\n          console.log(`[useFhevm] createFhevmInstance status changed: ${s}`),\n      })\n        .then((i) => {\n          console.log(`[useFhevm] createFhevmInstance created!`);\n          //console.log(`completed (runId=${thisRunId})...`);\n          if (thisSignal.aborted) return;\n\n          // is there a edge case where the assert below would fail ?\n          // it's not possible to have a _providerRef modified without a prior abort\n          _assert(\n            thisProvider === _providerRef.current,\n            \"thisProvider === _providerRef.current\"\n          );\n\n          _setInstance(i);\n          _setError(undefined);\n          _setStatus(\"ready\");\n        })\n        .catch((e) => {\n          // If cancellation operation (normal behavior), silently handle\n          if (\n            e instanceof Error && (\n              e.message.includes(\"FHEVM operation was cancelled\") ||\n              e.message.includes(\"operation was cancelled\") ||\n              e.name === \"FhevmAbortError\" ||\n              e.name === \"AbortError\"\n            )\n          ) {\n            // Cancellation is normal, no need to log error\n            if (thisSignal.aborted) return;\n            // Even if not explicitly cancelled, this is normal cancellation behavior\n            return;\n          }\n\n          // Convert technical errors to friendly error messages\n          const friendlyError = new Error(\n            e instanceof Error && e.message.includes(\"Failed to fetch\")\n              ? \"Network connection failed, please check your network connection or ensure Hardhat node is running\"\n              : e instanceof Error\n              ? e.message\n              : String(e)\n          );\n          friendlyError.name = e instanceof Error ? e.name : \"Error\";\n          \n          console.log(`[useFhevm] Error occurred: ${friendlyError.message}`);\n          if (thisSignal.aborted) return;\n\n          // it's not possible to have a _providerRef modified without a prior abort\n          _assert(\n            thisProvider === _providerRef.current,\n            \"thisProvider === _providerRef.current\"\n          );\n\n          _setInstance(undefined);\n          _setError(friendlyError);\n          _setStatus(\"error\");\n        });\n    }\n  }, [_isRunning, _providerChanged]);\n\n  return { instance, refresh, error, status };\n}\n\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 644, "column": 0}, "map": {"version":3,"sources":["file:///D:/Cursor-Ku/demo14/pro14/frontend/hooks/useEthersSigner.ts"],"sourcesContent":["import { useMemo, useState, useEffect } from 'react';\nimport { useWalletClient, usePublicClient } from 'wagmi';\nimport { BrowserProvider, JsonRpcSigner, JsonRpcProvider } from 'ethers';\n\nfunction walletClientToSigner(walletClient: any): Promise<JsonRpcSigner> {\n  const { account, chain, transport } = walletClient;\n  const network = {\n    chainId: chain.id,\n    name: chain.name,\n    ensAddress: chain.contracts?.ensRegistry?.address,\n  };\n\n  const provider = new BrowserProvider(transport, network);\n  const signer = provider.getSigner(account.address);\n  return signer;\n}\n\nexport function useEthersSigner({ chainId }: { chainId?: number } = {}) {\n  const { data: walletClient } = useWalletClient({ chainId });\n  const [signer, setSigner] = useState<JsonRpcSigner | undefined>(undefined);\n\n  useEffect(() => {\n    async function getSigner() {\n      if (walletClient) {\n        try {\n          const ethSigner = await walletClientToSigner(walletClient);\n          setSigner(ethSigner);\n        } catch (error) {\n          console.error('Error creating signer:', error);\n          setSigner(undefined);\n        }\n      } else {\n        setSigner(undefined);\n      }\n    }\n\n    getSigner();\n  }, [walletClient]);\n\n  return signer;\n}\n\nexport function useEthersProvider({ chainId }: { chainId?: number } = {}) {\n  const publicClient = usePublicClient({ chainId });\n\n  return useMemo(() => {\n    if (!publicClient || !chainId) return undefined;\n    \n    // Get RPC URL based on chainId\n    let rpcUrl: string | undefined;\n    if (chainId === 31337) {\n      // Hardhat local network\n      rpcUrl = \"http://localhost:8545\";\n    } else if (chainId === 11155111) {\n      // Sepolia\n      rpcUrl = `https://sepolia.infura.io/v3/${process.env.NEXT_PUBLIC_INFURA_API_KEY || \"b18fb7e6ca7045ac83c41157ab93f990\"}`;\n    } else {\n      // Try to get from chain config\n      const { chain } = publicClient;\n      if (chain.rpcUrls?.default?.http && chain.rpcUrls.default.http.length > 0) {\n        rpcUrl = chain.rpcUrls.default.http[0];\n      }\n    }\n    \n    if (!rpcUrl) return undefined;\n    \n    const network = {\n      chainId: chainId,\n      name: publicClient.chain.name,\n      ensAddress: publicClient.chain.contracts?.ensRegistry?.address,\n    };\n    return new JsonRpcProvider(rpcUrl, network);\n  }, [publicClient, chainId]);\n}\n\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AAAA;AACA;AAAA;;;;AAEA,SAAS,qBAAqB,YAAiB;IAC7C,MAAM,EAAE,OAAO,EAAE,KAAK,EAAE,SAAS,EAAE,GAAG;IACtC,MAAM,UAAU;QACd,SAAS,MAAM,EAAE;QACjB,MAAM,MAAM,IAAI;QAChB,YAAY,MAAM,SAAS,EAAE,aAAa;IAC5C;IAEA,MAAM,WAAW,IAAI,uMAAe,CAAC,WAAW;IAChD,MAAM,SAAS,SAAS,SAAS,CAAC,QAAQ,OAAO;IACjD,OAAO;AACT;AAEO,SAAS,gBAAgB,EAAE,OAAO,EAAwB,GAAG,CAAC,CAAC;IACpE,MAAM,EAAE,MAAM,YAAY,EAAE,GAAG,IAAA,+LAAe,EAAC;QAAE;IAAQ;IACzD,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,6NAAQ,EAA4B;IAEhE,IAAA,8NAAS,EAAC;QACR,eAAe;YACb,IAAI,cAAc;gBAChB,IAAI;oBACF,MAAM,YAAY,MAAM,qBAAqB;oBAC7C,UAAU;gBACZ,EAAE,OAAO,OAAO;oBACd,QAAQ,KAAK,CAAC,0BAA0B;oBACxC,UAAU;gBACZ;YACF,OAAO;gBACL,UAAU;YACZ;QACF;QAEA;IACF,GAAG;QAAC;KAAa;IAEjB,OAAO;AACT;AAEO,SAAS,kBAAkB,EAAE,OAAO,EAAwB,GAAG,CAAC,CAAC;IACtE,MAAM,eAAe,IAAA,+LAAe,EAAC;QAAE;IAAQ;IAE/C,OAAO,IAAA,4NAAO,EAAC;QACb,IAAI,CAAC,gBAAgB,CAAC,SAAS,OAAO;QAEtC,+BAA+B;QAC/B,IAAI;QACJ,IAAI,YAAY,OAAO;YACrB,wBAAwB;YACxB,SAAS;QACX,OAAO,IAAI,YAAY,UAAU;YAC/B,UAAU;YACV,SAAS,CAAC,6BAA6B,EAAE,QAAQ,GAAG,CAAC,0BAA0B,IAAI,oCAAoC;QACzH,OAAO;YACL,+BAA+B;YAC/B,MAAM,EAAE,KAAK,EAAE,GAAG;YAClB,IAAI,MAAM,OAAO,EAAE,SAAS,QAAQ,MAAM,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,MAAM,GAAG,GAAG;gBACzE,SAAS,MAAM,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE;YACxC;QACF;QAEA,IAAI,CAAC,QAAQ,OAAO;QAEpB,MAAM,UAAU;YACd,SAAS;YACT,MAAM,aAAa,KAAK,CAAC,IAAI;YAC7B,YAAY,aAAa,KAAK,CAAC,SAAS,EAAE,aAAa;QACzD;QACA,OAAO,IAAI,uMAAe,CAAC,QAAQ;IACrC,GAAG;QAAC;QAAc;KAAQ;AAC5B","debugId":null}},
    {"offset": {"line": 785, "column": 0}, "map": {"version":3,"sources":["file:///D:/Cursor-Ku/demo14/pro14/frontend/fhevm/FhevmDecryptionSignature.ts"],"sourcesContent":["import { ethers } from \"ethers\";\r\nimport {\r\n  EIP712Type,\r\n  FhevmDecryptionSignatureType,\r\n  FhevmInstance,\r\n} from \"./fhevmTypes\";\r\nimport { GenericStringStorage } from \"./GenericStringStorage\";\r\n\r\nfunction _timestampNow(): number {\r\n  return Math.floor(Date.now() / 1000);\r\n}\r\n\r\nclass FhevmDecryptionSignatureStorageKey {\r\n  #contractAddresses: `0x${string}`[];\r\n  #userAddress: `0x${string}`;\r\n  #publicKey: string | undefined;\r\n  #key: string;\r\n\r\n  constructor(\r\n    instance: FhevmInstance,\r\n    contractAddresses: string[],\r\n    userAddress: string,\r\n    publicKey?: string\r\n  ) {\r\n    if (!ethers.isAddress(userAddress)) {\r\n      throw new TypeError(`Invalid address ${userAddress}`);\r\n    }\r\n\r\n    const sortedContractAddresses = (\r\n      contractAddresses as `0x${string}`[]\r\n    ).sort();\r\n\r\n    const emptyEIP712 = instance.createEIP712(\r\n      publicKey ?? ethers.ZeroAddress,\r\n      sortedContractAddresses,\r\n      0,\r\n      0\r\n    );\r\n\r\n    try {\r\n      const hash = ethers.TypedDataEncoder.hash(\r\n        emptyEIP712.domain,\r\n        { UserDecryptRequestVerification: emptyEIP712.types.UserDecryptRequestVerification },\r\n        emptyEIP712.message\r\n      );\r\n\r\n      this.#contractAddresses = sortedContractAddresses;\r\n      this.#userAddress = userAddress as `0x${string}`;\r\n\r\n      this.#key = `${userAddress}:${hash}`;\r\n    } catch (e) {\r\n      console.log(e);\r\n      throw e;\r\n    }\r\n  }\r\n\r\n  get contractAddresses(): `0x${string}`[] {\r\n    return this.#contractAddresses;\r\n  }\r\n\r\n  get userAddress(): `0x${string}` {\r\n    return this.#userAddress;\r\n  }\r\n\r\n  get publicKey(): string | undefined {\r\n    return this.#publicKey;\r\n  }\r\n\r\n  get key(): string {\r\n    return this.#key;\r\n  }\r\n}\r\n\r\nexport class FhevmDecryptionSignature {\r\n  #publicKey: string;\r\n  #privateKey: string;\r\n  #signature: string;\r\n  #startTimestamp: number; // Unix timestamp in seconds\r\n  #durationDays: number;\r\n  #userAddress: `0x${string}`;\r\n  #contractAddresses: `0x${string}`[];\r\n  #eip712: EIP712Type;\r\n\r\n  private constructor(parameters: FhevmDecryptionSignatureType) {\r\n    if (!FhevmDecryptionSignature.checkIs(parameters)) {\r\n      throw new TypeError(\"Invalid FhevmDecryptionSignatureType\");\r\n    }\r\n    this.#publicKey = parameters.publicKey;\r\n    this.#privateKey = parameters.privateKey;\r\n    this.#signature = parameters.signature;\r\n    this.#startTimestamp = parameters.startTimestamp;\r\n    this.#durationDays = parameters.durationDays;\r\n    this.#userAddress = parameters.userAddress;\r\n    this.#contractAddresses = parameters.contractAddresses;\r\n    this.#eip712 = parameters.eip712;\r\n  }\r\n\r\n  public get privateKey() {\r\n    return this.#privateKey;\r\n  }\r\n\r\n  public get publicKey() {\r\n    return this.#publicKey;\r\n  }\r\n\r\n  public get signature() {\r\n    return this.#signature;\r\n  }\r\n\r\n  public get contractAddresses() {\r\n    return this.#contractAddresses;\r\n  }\r\n\r\n  public get startTimestamp() {\r\n    return this.#startTimestamp;\r\n  }\r\n\r\n  public get durationDays() {\r\n    return this.#durationDays;\r\n  }\r\n\r\n  public get userAddress() {\r\n    return this.#userAddress;\r\n  }\r\n\r\n  static checkIs(s: unknown): s is FhevmDecryptionSignatureType {\r\n    if (!s || typeof s !== \"object\") {\r\n      return false;\r\n    }\r\n    if (!(\"publicKey\" in s && typeof s.publicKey === \"string\")) {\r\n      return false;\r\n    }\r\n    if (!(\"privateKey\" in s && typeof s.privateKey === \"string\")) {\r\n      return false;\r\n    }\r\n    if (!(\"signature\" in s && typeof s.signature === \"string\")) {\r\n      return false;\r\n    }\r\n    if (!(\"startTimestamp\" in s && typeof s.startTimestamp === \"number\")) {\r\n      return false;\r\n    }\r\n    if (!(\"durationDays\" in s && typeof s.durationDays === \"number\")) {\r\n      return false;\r\n    }\r\n    if (!(\"contractAddresses\" in s && Array.isArray(s.contractAddresses))) {\r\n      return false;\r\n    }\r\n    for (let i = 0; i < s.contractAddresses.length; ++i) {\r\n      if (typeof s.contractAddresses[i] !== \"string\") return false;\r\n      if (!s.contractAddresses[i].startsWith(\"0x\")) return false;\r\n    }\r\n    if (\r\n      !(\r\n        \"userAddress\" in s &&\r\n        typeof s.userAddress === \"string\" &&\r\n        s.userAddress.startsWith(\"0x\")\r\n      )\r\n    ) {\r\n      return false;\r\n    }\r\n    if (!(\"eip712\" in s && typeof s.eip712 === \"object\" && s.eip712 !== null)) {\r\n      return false;\r\n    }\r\n\r\n    // Partial type check\r\n    if (!(\"domain\" in s.eip712 && typeof s.eip712.domain === \"object\")) {\r\n      return false;\r\n    }\r\n    if (\r\n      !(\"primaryType\" in s.eip712 && typeof s.eip712.primaryType === \"string\")\r\n    ) {\r\n      return false;\r\n    }\r\n    if (!(\"message\" in s.eip712)) {\r\n      return false;\r\n    }\r\n    if (\r\n      !(\r\n        \"types\" in s.eip712 &&\r\n        typeof s.eip712.types === \"object\" &&\r\n        s.eip712.types !== null\r\n      )\r\n    ) {\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  toJSON() {\r\n    return {\r\n      publicKey: this.#publicKey,\r\n      privateKey: this.#privateKey,\r\n      signature: this.#signature,\r\n      startTimestamp: this.#startTimestamp,\r\n      durationDays: this.#durationDays,\r\n      userAddress: this.#userAddress,\r\n      contractAddresses: this.#contractAddresses,\r\n      eip712: this.#eip712,\r\n    };\r\n  }\r\n\r\n  static fromJSON(json: unknown) {\r\n    const data = typeof json === \"string\" ? JSON.parse(json) : json;\r\n    return new FhevmDecryptionSignature(data);\r\n  }\r\n\r\n  equals(s: FhevmDecryptionSignatureType) {\r\n    return s.signature === this.#signature;\r\n  }\r\n\r\n  isValid(): boolean {\r\n    return (\r\n      _timestampNow() < this.#startTimestamp + this.#durationDays * 24 * 60 * 60\r\n    );\r\n  }\r\n\r\n  async saveToGenericStringStorage(\r\n    storage: GenericStringStorage,\r\n    instance: FhevmInstance,\r\n    withPublicKey: boolean\r\n  ) {\r\n    try {\r\n      const value = JSON.stringify(this);\r\n\r\n      const storageKey = new FhevmDecryptionSignatureStorageKey(\r\n        instance,\r\n        this.#contractAddresses,\r\n        this.#userAddress,\r\n        withPublicKey ? this.#publicKey : undefined\r\n      );\r\n      await storage.setItem(storageKey.key, value);\r\n      console.log(\r\n        `signature saved! contracts=${this.#contractAddresses.length}`\r\n      );\r\n    } catch {\r\n      console.error(\r\n        `FhevmDecryptionSignature.saveToGenericStringStorage() failed!`\r\n      );\r\n    }\r\n  }\r\n\r\n  static async loadFromGenericStringStorage(\r\n    storage: GenericStringStorage,\r\n    instance: FhevmInstance,\r\n    contractAddresses: string[],\r\n    userAddress: string,\r\n    publicKey?: string\r\n  ): Promise<FhevmDecryptionSignature | null> {\r\n    try {\r\n      const storageKey = new FhevmDecryptionSignatureStorageKey(\r\n        instance,\r\n        contractAddresses,\r\n        userAddress,\r\n        publicKey\r\n      );\r\n\r\n      const result = await storage.getItem(storageKey.key);\r\n\r\n      if (!result) {\r\n        console.warn(`Could not load signature! key=${storageKey.key}`);\r\n        return null;\r\n      }\r\n\r\n      try {\r\n        const kps = FhevmDecryptionSignature.fromJSON(result);\r\n        if (!kps.isValid()) {\r\n          return null;\r\n        }\r\n\r\n        return kps;\r\n      } catch {\r\n        return null;\r\n      }\r\n    } catch {\r\n      console.error(\r\n        `FhevmDecryptionSignature.loadFromGenericStringStorage() failed!`\r\n      );\r\n      return null;\r\n    }\r\n  }\r\n\r\n  static async new(\r\n    instance: FhevmInstance,\r\n    contractAddresses: string[],\r\n    publicKey: string,\r\n    privateKey: string,\r\n    signer: ethers.Signer\r\n  ): Promise<FhevmDecryptionSignature | null> {\r\n    try {\r\n      const userAddress = (await signer.getAddress()) as `0x${string}`;\r\n      const startTimestamp = _timestampNow();\r\n      const durationDays = 365;\r\n      const eip712 = instance.createEIP712(\r\n        publicKey,\r\n        contractAddresses,\r\n        startTimestamp,\r\n        durationDays\r\n      );\r\n      const signature = await signer.signTypedData(\r\n        eip712.domain,\r\n        { UserDecryptRequestVerification: eip712.types.UserDecryptRequestVerification },\r\n        eip712.message\r\n      );\r\n      return new FhevmDecryptionSignature({\r\n        publicKey,\r\n        privateKey,\r\n        contractAddresses: contractAddresses as `0x${string}`[],\r\n        startTimestamp,\r\n        durationDays,\r\n        signature,\r\n        eip712: eip712 as EIP712Type,\r\n        userAddress,\r\n      });\r\n    } catch {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  static async loadOrSign(\r\n    instance: FhevmInstance,\r\n    contractAddresses: string[],\r\n    signer: ethers.Signer,\r\n    storage: GenericStringStorage,\r\n    keyPair?: { publicKey: string; privateKey: string }\r\n  ): Promise<FhevmDecryptionSignature | null> {\r\n    const userAddress = (await signer.getAddress()) as `0x${string}`;\r\n\r\n    const cached: FhevmDecryptionSignature | null =\r\n      await FhevmDecryptionSignature.loadFromGenericStringStorage(\r\n        storage,\r\n        instance,\r\n        contractAddresses,\r\n        userAddress,\r\n        keyPair?.publicKey\r\n      );\r\n\r\n    if (cached) {\r\n      return cached;\r\n    }\r\n\r\n    const { publicKey, privateKey } = keyPair ?? instance.generateKeypair();\r\n\r\n    const sig = await FhevmDecryptionSignature.new(\r\n      instance,\r\n      contractAddresses,\r\n      publicKey,\r\n      privateKey,\r\n      signer\r\n    );\r\n\r\n    if (!sig) {\r\n      return null;\r\n    }\r\n\r\n    await sig.saveToGenericStringStorage(\r\n      storage,\r\n      instance,\r\n      Boolean(keyPair?.publicKey)\r\n    );\r\n\r\n    return sig;\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1016, "column": 0}, "map": {"version":3,"sources":["file:///D:/Cursor-Ku/demo14/pro14/frontend/abi/WeightTrendAddresses.ts"],"sourcesContent":["\n/*\n  This file is auto-generated.\n  Command: 'npm run genabi'\n*/\nexport const WeightTrendAddresses = { \n  \"11155111\": { address: \"0x6f39f4caD4C3ca052BB0CAe7AD4C957DE964E66B\", chainId: 11155111, chainName: \"sepolia\" },\n  \"31337\": { address: \"0x68B1D87F95878fE05B998F19b66F4baba5De1aed\", chainId: 31337, chainName: \"hardhat\" },\n};\n"],"names":[],"mappings":"AACA;;;AAGA;;;;AACO,MAAM,uBAAuB;IAClC,YAAY;QAAE,SAAS;QAA8C,SAAS;QAAU,WAAW;IAAU;IAC7G,SAAS;QAAE,SAAS;QAA8C,SAAS;QAAO,WAAW;IAAU;AACzG","debugId":null}},
    {"offset": {"line": 1039, "column": 0}, "map": {"version":3,"sources":["file:///D:/Cursor-Ku/demo14/pro14/frontend/abi/WeightTrendABI.ts"],"sourcesContent":["\n/*\n  This file is auto-generated.\n  Command: 'npm run genabi'\n*/\nexport const WeightTrendABI = {\n  \"abi\": [\n    {\n      \"inputs\": [],\n      \"name\": \"compareWeightTrend\",\n      \"outputs\": [\n        {\n          \"internalType\": \"ebool\",\n          \"name\": \"\",\n          \"type\": \"bytes32\"\n        }\n      ],\n      \"stateMutability\": \"nonpayable\",\n      \"type\": \"function\"\n    },\n    {\n      \"inputs\": [],\n      \"name\": \"getLastUpdateDay\",\n      \"outputs\": [\n        {\n          \"internalType\": \"uint256\",\n          \"name\": \"\",\n          \"type\": \"uint256\"\n        }\n      ],\n      \"stateMutability\": \"view\",\n      \"type\": \"function\"\n    },\n    {\n      \"inputs\": [],\n      \"name\": \"getTodayWeight\",\n      \"outputs\": [\n        {\n          \"internalType\": \"euint32\",\n          \"name\": \"\",\n          \"type\": \"bytes32\"\n        }\n      ],\n      \"stateMutability\": \"view\",\n      \"type\": \"function\"\n    },\n    {\n      \"inputs\": [\n        {\n          \"internalType\": \"uint256\",\n          \"name\": \"day\",\n          \"type\": \"uint256\"\n        }\n      ],\n      \"name\": \"getWeight\",\n      \"outputs\": [\n        {\n          \"internalType\": \"euint32\",\n          \"name\": \"\",\n          \"type\": \"bytes32\"\n        }\n      ],\n      \"stateMutability\": \"view\",\n      \"type\": \"function\"\n    },\n    {\n      \"inputs\": [],\n      \"name\": \"getYesterdayWeight\",\n      \"outputs\": [\n        {\n          \"internalType\": \"euint32\",\n          \"name\": \"\",\n          \"type\": \"bytes32\"\n        }\n      ],\n      \"stateMutability\": \"view\",\n      \"type\": \"function\"\n    },\n    {\n      \"inputs\": [\n        {\n          \"internalType\": \"uint256\",\n          \"name\": \"day\",\n          \"type\": \"uint256\"\n        }\n      ],\n      \"name\": \"hasRecord\",\n      \"outputs\": [\n        {\n          \"internalType\": \"bool\",\n          \"name\": \"\",\n          \"type\": \"bool\"\n        }\n      ],\n      \"stateMutability\": \"view\",\n      \"type\": \"function\"\n    },\n    {\n      \"inputs\": [],\n      \"name\": \"protocolId\",\n      \"outputs\": [\n        {\n          \"internalType\": \"uint256\",\n          \"name\": \"\",\n          \"type\": \"uint256\"\n        }\n      ],\n      \"stateMutability\": \"pure\",\n      \"type\": \"function\"\n    },\n    {\n      \"inputs\": [\n        {\n          \"internalType\": \"externalEuint32\",\n          \"name\": \"weight\",\n          \"type\": \"bytes32\"\n        },\n        {\n          \"internalType\": \"bytes\",\n          \"name\": \"inputProof\",\n          \"type\": \"bytes\"\n        }\n      ],\n      \"name\": \"submitWeight\",\n      \"outputs\": [],\n      \"stateMutability\": \"nonpayable\",\n      \"type\": \"function\"\n    }\n  ]\n} as const;\n\n"],"names":[],"mappings":"AACA;;;AAGA;;;;AACO,MAAM,iBAAiB;IAC5B,OAAO;QACL;YACE,UAAU,EAAE;YACZ,QAAQ;YACR,WAAW;gBACT;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,mBAAmB;YACnB,QAAQ;QACV;QACA;YACE,UAAU,EAAE;YACZ,QAAQ;YACR,WAAW;gBACT;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,mBAAmB;YACnB,QAAQ;QACV;QACA;YACE,UAAU,EAAE;YACZ,QAAQ;YACR,WAAW;gBACT;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,mBAAmB;YACnB,QAAQ;QACV;QACA;YACE,UAAU;gBACR;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,QAAQ;YACR,WAAW;gBACT;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,mBAAmB;YACnB,QAAQ;QACV;QACA;YACE,UAAU,EAAE;YACZ,QAAQ;YACR,WAAW;gBACT;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,mBAAmB;YACnB,QAAQ;QACV;QACA;YACE,UAAU;gBACR;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,QAAQ;YACR,WAAW;gBACT;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,mBAAmB;YACnB,QAAQ;QACV;QACA;YACE,UAAU,EAAE;YACZ,QAAQ;YACR,WAAW;gBACT;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,mBAAmB;YACnB,QAAQ;QACV;QACA;YACE,UAAU;gBACR;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;gBACA;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,QAAQ;YACR,WAAW,EAAE;YACb,mBAAmB;YACnB,QAAQ;QACV;KACD;AACH","debugId":null}},
    {"offset": {"line": 1175, "column": 0}, "map": {"version":3,"sources":["file:///D:/Cursor-Ku/demo14/pro14/frontend/hooks/useWeightTrend.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { ethers } from \"ethers\";\r\nimport {\r\n  RefObject,\r\n  useCallback,\r\n  useEffect,\r\n  useMemo,\r\n  useRef,\r\n  useState,\r\n} from \"react\";\r\n\r\nimport { FhevmInstance } from \"@/fhevm/fhevmTypes\";\r\nimport { FhevmDecryptionSignature } from \"@/fhevm/FhevmDecryptionSignature\";\r\nimport { GenericStringStorage } from \"@/fhevm/GenericStringStorage\";\r\n\r\n// These files are auto-generated by genabi.mjs\r\nimport { WeightTrendAddresses } from \"@/abi/WeightTrendAddresses\";\r\nimport { WeightTrendABI } from \"@/abi/WeightTrendABI\";\r\n\r\nexport type ClearValueType = {\r\n  handle: string;\r\n  clear: string | bigint | boolean;\r\n};\r\n\r\ntype WeightTrendInfoType = {\r\n  abi: typeof WeightTrendABI.abi;\r\n  address?: `0x${string}`;\r\n  chainId?: number;\r\n  chainName?: string;\r\n};\r\n\r\nfunction getWeightTrendByChainId(\r\n  chainId: number | undefined\r\n): WeightTrendInfoType {\r\n  if (!chainId) {\r\n    return { abi: WeightTrendABI.abi };\r\n  }\r\n\r\n  const entry =\r\n    WeightTrendAddresses[chainId.toString() as keyof typeof WeightTrendAddresses];\r\n\r\n  if (!(\"address\" in entry) || entry.address === ethers.ZeroAddress) {\r\n    return { abi: WeightTrendABI.abi, chainId };\r\n  }\r\n\r\n  return {\r\n    address: entry?.address as `0x${string}` | undefined,\r\n    chainId: entry?.chainId ?? chainId,\r\n    chainName: entry?.chainName,\r\n    abi: WeightTrendABI.abi,\r\n  };\r\n}\r\n\r\nexport const useWeightTrend = (parameters: {\r\n  instance: FhevmInstance | undefined;\r\n  fhevmDecryptionSignatureStorage: GenericStringStorage;\r\n  chainId: number | undefined;\r\n  ethersSigner: ethers.JsonRpcSigner | undefined;\r\n  ethersReadonlyProvider: ethers.ContractRunner | undefined;\r\n  sameChain: RefObject<(chainId: number | undefined) => boolean>;\r\n  sameSigner: RefObject<\r\n    (ethersSigner: ethers.JsonRpcSigner | undefined) => boolean\r\n  >;\r\n}) => {\r\n  const {\r\n    instance,\r\n    fhevmDecryptionSignatureStorage,\r\n    chainId,\r\n    ethersSigner,\r\n    ethersReadonlyProvider,\r\n    sameChain,\r\n    sameSigner,\r\n  } = parameters;\r\n\r\n  const [todayWeightHandle, setTodayWeightHandle] = useState<string | undefined>(undefined);\r\n  const [trendHandle, setTrendHandle] = useState<string | undefined>(undefined);\r\n  const [clearTodayWeight, setClearTodayWeight] = useState<ClearValueType | undefined>(undefined);\r\n  const [clearTrend, setClearTrend] = useState<ClearValueType | undefined>(undefined);\r\n  const clearTodayWeightRef = useRef<ClearValueType>(undefined);\r\n  const clearTrendRef = useRef<ClearValueType>(undefined);\r\n  const [isRefreshing, setIsRefreshing] = useState<boolean>(false);\r\n  const [isDecrypting, setIsDecrypting] = useState<boolean>(false);\r\n  const [isSubmitting, setIsSubmitting] = useState<boolean>(false);\r\n  const [isComparing, setIsComparing] = useState<boolean>(false);\r\n  const [message, setMessage] = useState<string>(\"\");\r\n\r\n  const weightTrendRef = useRef<WeightTrendInfoType | undefined>(undefined);\r\n  const isRefreshingRef = useRef<boolean>(isRefreshing);\r\n  const isDecryptingRef = useRef<boolean>(isDecrypting);\r\n  const isSubmittingRef = useRef<boolean>(isSubmitting);\r\n  const isComparingRef = useRef<boolean>(isComparing);\r\n\r\n  const isTodayWeightDecrypted = todayWeightHandle && todayWeightHandle === clearTodayWeight?.handle;\r\n  const isTrendDecrypted = trendHandle && trendHandle === clearTrend?.handle;\r\n\r\n  const weightTrend = useMemo(() => {\r\n    const c = getWeightTrendByChainId(chainId);\r\n    weightTrendRef.current = c;\r\n    if (!c.address) {\r\n      setMessage(`WeightTrend deployment not found for chainId=${chainId}.`);\r\n    }\r\n    return c;\r\n  }, [chainId]);\r\n\r\n  const isDeployed = useMemo(() => {\r\n    if (!weightTrend) {\r\n      return undefined;\r\n    }\r\n    return (Boolean(weightTrend.address) && weightTrend.address !== ethers.ZeroAddress);\r\n  }, [weightTrend]);\r\n\r\n  const canGetTodayWeight = useMemo(() => {\r\n    return weightTrend.address && ethersReadonlyProvider && !isRefreshing;\r\n  }, [weightTrend.address, ethersReadonlyProvider, isRefreshing]);\r\n\r\n  const refreshTodayWeight = useCallback(() => {\r\n    if (isRefreshingRef.current) {\r\n      return;\r\n    }\r\n\r\n    if (\r\n      !weightTrendRef.current ||\r\n      !weightTrendRef.current?.chainId ||\r\n      !weightTrendRef.current?.address ||\r\n      !ethersReadonlyProvider\r\n    ) {\r\n      setTodayWeightHandle(undefined);\r\n      return;\r\n    }\r\n\r\n    isRefreshingRef.current = true;\r\n    setIsRefreshing(true);\r\n\r\n    const thisChainId = weightTrendRef.current.chainId;\r\n    const thisAddress = weightTrendRef.current.address;\r\n\r\n    const contract = new ethers.Contract(\r\n      thisAddress,\r\n      weightTrendRef.current.abi,\r\n      ethersReadonlyProvider\r\n    );\r\n\r\n    contract\r\n      .getTodayWeight()\r\n      .then((value) => {\r\n        if (\r\n          sameChain.current(thisChainId) &&\r\n          thisAddress === weightTrendRef.current?.address\r\n        ) {\r\n          setTodayWeightHandle(value);\r\n        }\r\n        isRefreshingRef.current = false;\r\n        setIsRefreshing(false);\r\n      })\r\n      .catch((e) => {\r\n        // Ensure error message is a string to avoid rendering objects\r\n        const errorMsg = e instanceof Error \r\n          ? e.message \r\n          : typeof e === 'object' && e !== null && ('hash' in e || 'blockNumber' in e)\r\n          ? \"Transaction processing failed, please try again\"\r\n          : String(e);\r\n        setMessage(\"WeightTrend.getTodayWeight() call failed! error=\" + errorMsg);\r\n        isRefreshingRef.current = false;\r\n        setIsRefreshing(false);\r\n      });\r\n  }, [ethersReadonlyProvider, sameChain]);\r\n\r\n  useEffect(() => {\r\n    refreshTodayWeight();\r\n  }, [refreshTodayWeight]);\r\n\r\n  const canDecryptTodayWeight = useMemo(() => {\r\n    return (\r\n      weightTrend.address &&\r\n      instance &&\r\n      ethersSigner &&\r\n      !isRefreshing &&\r\n      !isDecrypting &&\r\n      todayWeightHandle &&\r\n      todayWeightHandle !== ethers.ZeroHash &&\r\n      todayWeightHandle !== clearTodayWeight?.handle\r\n    );\r\n  }, [\r\n    weightTrend.address,\r\n    instance,\r\n    ethersSigner,\r\n    isRefreshing,\r\n    isDecrypting,\r\n    todayWeightHandle,\r\n    clearTodayWeight,\r\n  ]);\r\n\r\n  const decryptTodayWeight = useCallback(() => {\r\n    if (isRefreshingRef.current || isDecryptingRef.current) {\r\n      return;\r\n    }\r\n\r\n    if (!weightTrend.address || !instance || !ethersSigner) {\r\n      return;\r\n    }\r\n\r\n    if (todayWeightHandle === clearTodayWeightRef.current?.handle) {\r\n      return;\r\n    }\r\n\r\n    if (!todayWeightHandle) {\r\n      setClearTodayWeight(undefined);\r\n      clearTodayWeightRef.current = undefined;\r\n      return;\r\n    }\r\n\r\n    if (todayWeightHandle === ethers.ZeroHash) {\r\n      setClearTodayWeight({ handle: todayWeightHandle, clear: BigInt(0) });\r\n      clearTodayWeightRef.current = { handle: todayWeightHandle, clear: BigInt(0) };\r\n      return;\r\n    }\r\n\r\n    const thisChainId = chainId;\r\n    const thisAddress = weightTrend.address;\r\n    const thisHandle = todayWeightHandle;\r\n    const thisEthersSigner = ethersSigner;\r\n\r\n    isDecryptingRef.current = true;\r\n    setIsDecrypting(true);\r\n    setMessage(\"Start decrypting today's weight...\");\r\n\r\n    const run = async () => {\r\n      const isStale = () =>\r\n        thisAddress !== weightTrendRef.current?.address ||\r\n        !sameChain.current(thisChainId) ||\r\n        !sameSigner.current(thisEthersSigner);\r\n\r\n      try {\r\n        const sig: FhevmDecryptionSignature | null =\r\n          await FhevmDecryptionSignature.loadOrSign(\r\n            instance,\r\n            [weightTrend.address as `0x${string}`],\r\n            ethersSigner,\r\n            fhevmDecryptionSignatureStorage\r\n          );\r\n\r\n        if (!sig) {\r\n          setMessage(\"Unable to build FHEVM decryption signature\");\r\n          return;\r\n        }\r\n\r\n        if (isStale()) {\r\n          setMessage(\"Ignore FHEVM decryption\");\r\n          return;\r\n        }\r\n\r\n        setMessage(\"Call FHEVM userDecrypt...\");\r\n\r\n        const res = await instance.userDecrypt(\r\n          [{ handle: thisHandle, contractAddress: thisAddress }],\r\n          sig.privateKey,\r\n          sig.publicKey,\r\n          sig.signature,\r\n          sig.contractAddresses,\r\n          sig.userAddress,\r\n          sig.startTimestamp,\r\n          sig.durationDays\r\n        );\r\n\r\n        setMessage(\"FHEVM userDecrypt completed!\");\r\n\r\n        if (isStale()) {\r\n          setMessage(\"Ignore FHEVM decryption\");\r\n          return;\r\n        }\r\n\r\n        setClearTodayWeight({ handle: thisHandle, clear: res[thisHandle] });\r\n        clearTodayWeightRef.current = {\r\n          handle: thisHandle,\r\n          clear: res[thisHandle],\r\n        };\r\n\r\n        setMessage(\r\n          \"Today's weight decrypted: \" + clearTodayWeightRef.current.clear\r\n        );\r\n      } finally {\r\n        isDecryptingRef.current = false;\r\n        setIsDecrypting(false);\r\n      }\r\n    };\r\n\r\n    run();\r\n  }, [\r\n    fhevmDecryptionSignatureStorage,\r\n    ethersSigner,\r\n    weightTrend.address,\r\n    instance,\r\n    todayWeightHandle,\r\n    chainId,\r\n    sameChain,\r\n    sameSigner,\r\n  ]);\r\n\r\n  const canSubmitWeight = useMemo(() => {\r\n    return (\r\n      weightTrend.address &&\r\n      instance &&\r\n      ethersSigner &&\r\n      !isRefreshing &&\r\n      !isSubmitting\r\n    );\r\n  }, [weightTrend.address, instance, ethersSigner, isRefreshing, isSubmitting]);\r\n\r\n  const submitWeight = useCallback(\r\n    (weight: number) => {\r\n      if (isRefreshingRef.current || isSubmittingRef.current) {\r\n        return;\r\n      }\r\n\r\n      if (!weightTrend.address || !instance || !ethersSigner || weight <= 0) {\r\n        return;\r\n      }\r\n\r\n      const thisChainId = chainId;\r\n      const thisAddress = weightTrend.address;\r\n      const thisEthersSigner = ethersSigner;\r\n\r\n      const contract = new ethers.Contract(\r\n        thisAddress,\r\n        weightTrend.abi,\r\n        thisEthersSigner\r\n      );\r\n\r\n      isSubmittingRef.current = true;\r\n      setIsSubmitting(true);\r\n      setMessage(`Submitting weight ${weight}...`);\r\n\r\n      const run = async () => {\r\n        await new Promise((resolve) => setTimeout(resolve, 100));\r\n\r\n        const isStale = () =>\r\n          thisAddress !== weightTrendRef.current?.address ||\r\n          !sameChain.current(thisChainId) ||\r\n          !sameSigner.current(thisEthersSigner);\r\n\r\n        try {\r\n          const input = instance.createEncryptedInput(\r\n            thisAddress,\r\n            thisEthersSigner.address\r\n          );\r\n          input.add32(weight);\r\n\r\n          const enc = await input.encrypt();\r\n\r\n          if (isStale()) {\r\n            setMessage(\"Ignore submitWeight\");\r\n            return;\r\n          }\r\n\r\n          setMessage(\"Call submitWeight...\");\r\n\r\n          const tx: ethers.TransactionResponse = await contract.submitWeight(\r\n            enc.handles[0],\r\n            enc.inputProof\r\n          );\r\n\r\n          setMessage(`Wait for tx:${tx.hash}...`);\r\n\r\n          const receipt = await tx.wait();\r\n\r\n          setMessage(`SubmitWeight completed status=${receipt?.status}`);\r\n\r\n          if (isStale()) {\r\n            setMessage(\"Ignore submitWeight\");\r\n            return;\r\n          }\r\n\r\n          refreshTodayWeight();\r\n        } catch (e) {\r\n          // Ensure error message is a string to avoid rendering objects\r\n          const errorMsg = e instanceof Error \r\n            ? e.message \r\n            : typeof e === 'object' && e !== null && ('hash' in e || 'blockNumber' in e)\r\n            ? \"Transaction processing failed, please try again\"\r\n            : String(e);\r\n          setMessage(`SubmitWeight Failed! ${errorMsg}`);\r\n        } finally {\r\n          isSubmittingRef.current = false;\r\n          setIsSubmitting(false);\r\n        }\r\n      };\r\n\r\n      run();\r\n    },\r\n    [\r\n      ethersSigner,\r\n      weightTrend.address,\r\n      weightTrend.abi,\r\n      instance,\r\n      chainId,\r\n      refreshTodayWeight,\r\n      sameChain,\r\n      sameSigner,\r\n    ]\r\n  );\r\n\r\n  const canCompareTrend = useMemo(() => {\r\n    return (\r\n      weightTrend.address &&\r\n      ethersSigner && // Need signer because compareWeightTrend is nonpayable\r\n      !isRefreshing &&\r\n      !isComparing\r\n    );\r\n  }, [weightTrend.address, ethersSigner, isRefreshing, isComparing]);\r\n\r\n  const compareTrend = useCallback(() => {\r\n    if (isRefreshingRef.current || isComparingRef.current) {\r\n      return;\r\n    }\r\n\r\n    if (\r\n      !weightTrendRef.current ||\r\n      !weightTrendRef.current?.chainId ||\r\n      !weightTrendRef.current?.address ||\r\n      !ethersSigner // Need signer because compareWeightTrend is nonpayable\r\n    ) {\r\n      setTrendHandle(undefined);\r\n      setMessage(\"Please connect wallet to compare weight trend\");\r\n      return;\r\n    }\r\n\r\n    isComparingRef.current = true;\r\n    setIsComparing(true);\r\n    setMessage(\"Comparing weight trend...\");\r\n\r\n    const thisChainId = weightTrendRef.current.chainId;\r\n    const thisAddress = weightTrendRef.current.address;\r\n    const thisEthersSigner = ethersSigner;\r\n\r\n    const contract = new ethers.Contract(\r\n      thisAddress,\r\n      weightTrendRef.current.abi,\r\n      thisEthersSigner // Use signer instead of readonly provider\r\n    );\r\n\r\n    const run = async () => {\r\n      try {\r\n        const isStale = () =>\r\n          thisAddress !== weightTrendRef.current?.address ||\r\n          !sameChain.current(thisChainId) ||\r\n          !sameSigner.current(thisEthersSigner);\r\n\r\n        setMessage(\"Calling compareWeightTrend...\");\r\n\r\n        // compareWeightTrend is nonpayable and will send a transaction\r\n        // In ethers.js v6, nonpayable functions with return values may return TransactionResponse\r\n        // We need to check the return type and handle it correctly\r\n        \r\n        const result = await contract.compareWeightTrend();\r\n        \r\n        // Check return type: if TransactionResponse, wait for confirmation then use staticCall\r\n        let encryptedTrend: string;\r\n        \r\n        if (result && typeof result === 'object' && 'hash' in result && 'wait' in result) {\r\n          // Returned TransactionResponse, need to wait for confirmation\r\n          const tx = result as ethers.TransactionResponse;\r\n          setMessage(`Waiting for transaction confirmation: ${tx.hash}...`);\r\n          \r\n          const receipt = await tx.wait();\r\n          \r\n          if (isStale()) {\r\n            setMessage(\"Ignoring compareWeightTrend result\");\r\n            return;\r\n          }\r\n\r\n          if (!receipt || receipt.status !== 1) {\r\n            setMessage(\"Transaction failed, please try again\");\r\n            return;\r\n          }\r\n\r\n          // After confirmation, use staticCall to get return value\r\n          setMessage(\"Getting comparison result...\");\r\n          const callResult = await contract.compareWeightTrend.staticCall();\r\n          \r\n          // Ensure return value is a string\r\n          if (typeof callResult === 'string') {\r\n            encryptedTrend = callResult;\r\n          } else {\r\n            encryptedTrend = String(callResult);\r\n          }\r\n        } else if (typeof result === 'string') {\r\n          // Directly returned string (ebool handle)\r\n          encryptedTrend = result;\r\n        } else {\r\n          // Other cases, convert to string\r\n          encryptedTrend = String(result);\r\n        }\r\n\r\n        if (isStale()) {\r\n          setMessage(\"Ignoring compareWeightTrend result\");\r\n          return;\r\n        }\r\n\r\n        // Check return value\r\n        if (!encryptedTrend || encryptedTrend === ethers.ZeroHash || encryptedTrend === \"0x0000000000000000000000000000000000000000000000000000000000000000\") {\r\n          setMessage(\"No trend data available (need at least 2 days of data)\");\r\n          setTrendHandle(ethers.ZeroHash);\r\n        } else {\r\n          setMessage(`Comparison completed, encrypted trend result obtained`);\r\n          setTrendHandle(encryptedTrend);\r\n        }\r\n\r\n        if (isStale()) {\r\n          setMessage(\"Ignoring compareWeightTrend result\");\r\n          return;\r\n        }\r\n      } catch (e) {\r\n        // Ensure error message is a string to avoid rendering objects\r\n        const errorMessage = e instanceof Error \r\n          ? e.message \r\n          : typeof e === 'object' && e !== null && ('hash' in e || 'blockNumber' in e)\r\n          ? \"Transaction processing failed, please try again\"\r\n          : String(e);\r\n        setMessage(`WeightTrend.compareWeightTrend() call failed! error=${errorMessage}`);\r\n        console.error(\"compareWeightTrend error:\", e);\r\n      } finally {\r\n        isComparingRef.current = false;\r\n        setIsComparing(false);\r\n      }\r\n    };\r\n\r\n    run();\r\n  }, [ethersSigner, sameChain, sameSigner]);\r\n\r\n  const canDecryptTrend = useMemo(() => {\r\n    return (\r\n      weightTrend.address &&\r\n      instance &&\r\n      ethersSigner &&\r\n      !isRefreshing &&\r\n      !isDecrypting &&\r\n      trendHandle &&\r\n      trendHandle !== ethers.ZeroHash &&\r\n      trendHandle !== clearTrend?.handle\r\n    );\r\n  }, [\r\n    weightTrend.address,\r\n    instance,\r\n    ethersSigner,\r\n    isRefreshing,\r\n    isDecrypting,\r\n    trendHandle,\r\n    clearTrend,\r\n  ]);\r\n\r\n  const decryptTrend = useCallback(() => {\r\n    if (isRefreshingRef.current || isDecryptingRef.current) {\r\n      return;\r\n    }\r\n\r\n    if (!weightTrend.address || !instance || !ethersSigner) {\r\n      return;\r\n    }\r\n\r\n    if (trendHandle === clearTrendRef.current?.handle) {\r\n      return;\r\n    }\r\n\r\n    if (!trendHandle) {\r\n      setClearTrend(undefined);\r\n      clearTrendRef.current = undefined;\r\n      return;\r\n    }\r\n\r\n    if (trendHandle === ethers.ZeroHash) {\r\n      setClearTrend({ handle: trendHandle, clear: false });\r\n      clearTrendRef.current = { handle: trendHandle, clear: false };\r\n      return;\r\n    }\r\n\r\n    const thisChainId = chainId;\r\n    const thisAddress = weightTrend.address;\r\n    const thisHandle = trendHandle;\r\n    const thisEthersSigner = ethersSigner;\r\n\r\n    isDecryptingRef.current = true;\r\n    setIsDecrypting(true);\r\n    setMessage(\"Start decrypting trend...\");\r\n\r\n    const run = async () => {\r\n      const isStale = () =>\r\n        thisAddress !== weightTrendRef.current?.address ||\r\n        !sameChain.current(thisChainId) ||\r\n        !sameSigner.current(thisEthersSigner);\r\n\r\n      try {\r\n        const sig: FhevmDecryptionSignature | null =\r\n          await FhevmDecryptionSignature.loadOrSign(\r\n            instance,\r\n            [weightTrend.address as `0x${string}`],\r\n            ethersSigner,\r\n            fhevmDecryptionSignatureStorage\r\n          );\r\n\r\n        if (!sig) {\r\n          setMessage(\"Unable to build FHEVM decryption signature\");\r\n          return;\r\n        }\r\n\r\n        if (isStale()) {\r\n          setMessage(\"Ignore FHEVM decryption\");\r\n          return;\r\n        }\r\n\r\n        setMessage(\"Call FHEVM userDecrypt...\");\r\n\r\n        // Use userDecrypt method to decrypt ebool (same way as decrypting euint32)\r\n        const res = await instance.userDecrypt(\r\n          [{ handle: thisHandle, contractAddress: thisAddress }],\r\n          sig.privateKey,\r\n          sig.publicKey,\r\n          sig.signature,\r\n          sig.contractAddresses,\r\n          sig.userAddress,\r\n          sig.startTimestamp,\r\n          sig.durationDays\r\n        );\r\n\r\n        setMessage(\"FHEVM userDecrypt completed!\");\r\n\r\n        if (isStale()) {\r\n          setMessage(\"Ignore FHEVM decryption\");\r\n          return;\r\n        }\r\n\r\n        // res is a DecryptedResults object, key is handle, value is decrypted value (boolean for ebool)\r\n        const decryptedValue = res[thisHandle];\r\n        \r\n        // Ensure value is boolean type\r\n        const clearTrend: boolean = typeof decryptedValue === 'boolean' \r\n          ? decryptedValue \r\n          : typeof decryptedValue === 'bigint' \r\n            ? decryptedValue !== 0n \r\n            : Boolean(decryptedValue);\r\n\r\n        setClearTrend({ handle: thisHandle, clear: clearTrend });\r\n        clearTrendRef.current = {\r\n          handle: thisHandle,\r\n          clear: clearTrend,\r\n        };\r\n\r\n        setMessage(\r\n          \"Trend decrypted: \" + (clearTrend ? \"Weight decreased! \" : \"Weight increased or same \")\r\n        );\r\n      } finally {\r\n        isDecryptingRef.current = false;\r\n        setIsDecrypting(false);\r\n      }\r\n    };\r\n\r\n    run();\r\n  }, [\r\n    fhevmDecryptionSignatureStorage,\r\n    ethersSigner,\r\n    weightTrend.address,\r\n    instance,\r\n    trendHandle,\r\n    chainId,\r\n    sameChain,\r\n    sameSigner,\r\n  ]);\r\n\r\n  return {\r\n    contractAddress: weightTrend.address,\r\n    canGetTodayWeight,\r\n    canDecryptTodayWeight,\r\n    canSubmitWeight,\r\n    canCompareTrend,\r\n    canDecryptTrend,\r\n    submitWeight,\r\n    refreshTodayWeight,\r\n    decryptTodayWeight,\r\n    compareTrend,\r\n    decryptTrend,\r\n    isTodayWeightDecrypted,\r\n    isTrendDecrypted,\r\n    message,\r\n    clearTodayWeight: clearTodayWeight?.clear,\r\n    clearTrend: clearTrend?.clear,\r\n    todayWeightHandle,\r\n    trendHandle,\r\n    isDecrypting,\r\n    isRefreshing,\r\n    isSubmitting,\r\n    isComparing,\r\n    isDeployed,\r\n  };\r\n};\r\n\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1678, "column": 0}, "map": {"version":3,"sources":["file:///D:/Cursor-Ku/demo14/pro14/frontend/components/ErrorNotDeployed.tsx"],"sourcesContent":["export function errorNotDeployed(chainId: number | undefined) {\r\n  return (\r\n    <div className=\"grid w-full gap-4 mx-auto font-semibold bg-none\">\r\n      <div className=\"col-span-full mx-20\">\r\n        <p className=\"text-4xl leading-relaxed\">\r\n          {\" \"}\r\n          <span className=\"font-mono bg-red-500\">Error</span>:{\" \"}\r\n          <span className=\"font-mono bg-white\">WeightTrend.sol</span> Contract\r\n          Not Deployed on{\" \"}\r\n          <span className=\"font-mono bg-white\">chainId={chainId}</span>{\" \"}\r\n          {chainId === 11155111 ? \"(Sepolia)\" : \"\"} or Deployment Address\r\n          Missing.\r\n        </p>\r\n        <p className=\"text-xl leading-relaxed mt-8\">\r\n          It appears that the{\" \"}\r\n          <span className=\"font-mono bg-white\">WeightTrend.sol</span> contract\r\n          has either not been deployed yet, or the deployment address is missing\r\n          from the ABI directory{\" \"}\r\n          <span className=\"font-mono bg-white\">frontend/abi</span>. To\r\n          deploy <span className=\"font-mono bg-white\">WeightTrend.sol</span> on\r\n          Sepolia, run the following command:\r\n        </p>\r\n        <p className=\"font-mono text-2xl leading-relaxed bg-black text-white p-4 mt-12\">\r\n          <span className=\"opacity-50 italic text-red-500\">\r\n            #from root directory\r\n          </span>\r\n          <br />\r\n          npx hardhat deploy --network{\" \"}\r\n          {chainId === 11155111 ? \"sepolia\" : \"your-network-name\"}\r\n        </p>\r\n        <p className=\"text-xl leading-relaxed mt-12\">\r\n          Alternatively, switch to the local{\" \"}\r\n          <span className=\"font-mono bg-white\">Hardhat Node</span> using the\r\n          Rainbow wallet browser extension.\r\n        </p>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;;AAAO,SAAS,iBAAiB,OAA2B;IAC1D,qBACE,0PAAC;QAAI,WAAU;kBACb,cAAA,0PAAC;YAAI,WAAU;;8BACb,0PAAC;oBAAE,WAAU;;wBACV;sCACD,0PAAC;4BAAK,WAAU;sCAAuB;;;;;;wBAAY;wBAAE;sCACrD,0PAAC;4BAAK,WAAU;sCAAqB;;;;;;wBAAsB;wBAC3C;sCAChB,0PAAC;4BAAK,WAAU;;gCAAqB;gCAAS;;;;;;;wBAAgB;wBAC7D,YAAY,WAAW,cAAc;wBAAG;;;;;;;8BAG3C,0PAAC;oBAAE,WAAU;;wBAA+B;wBACtB;sCACpB,0PAAC;4BAAK,WAAU;sCAAqB;;;;;;wBAAsB;wBAEpC;sCACvB,0PAAC;4BAAK,WAAU;sCAAqB;;;;;;wBAAmB;sCACjD,0PAAC;4BAAK,WAAU;sCAAqB;;;;;;wBAAsB;;;;;;;8BAGpE,0PAAC;oBAAE,WAAU;;sCACX,0PAAC;4BAAK,WAAU;sCAAiC;;;;;;sCAGjD,0PAAC;;;;;wBAAK;wBACuB;wBAC5B,YAAY,WAAW,YAAY;;;;;;;8BAEtC,0PAAC;oBAAE,WAAU;;wBAAgC;wBACR;sCACnC,0PAAC;4BAAK,WAAU;sCAAqB;;;;;;wBAAmB;;;;;;;;;;;;;;;;;;AAMlE","debugId":null}},
    {"offset": {"line": 1834, "column": 0}, "map": {"version":3,"sources":["file:///D:/Cursor-Ku/demo14/pro14/frontend/components/WeightTrendDemo.tsx"],"sourcesContent":["\"use client\";\n\nimport { useFhevm } from \"@/fhevm/useFhevm\";\nimport { useInMemoryStorage } from \"@/hooks/useInMemoryStorage\";\nimport { useEthersSigner, useEthersProvider } from \"@/hooks/useEthersSigner\";\nimport { useWeightTrend } from \"@/hooks/useWeightTrend\";\nimport { errorNotDeployed } from \"./ErrorNotDeployed\";\nimport { useAccount, useChainId, usePublicClient } from \"wagmi\";\nimport { useRef, useState, useMemo, useEffect } from \"react\";\nimport { getFriendlyErrorMessage } from \"@/utils/errorHandler\";\n\nexport const WeightTrendDemo = () => {\n  const { storage: fhevmDecryptionSignatureStorage } = useInMemoryStorage();\n  const { address, isConnected } = useAccount();\n  const chainId = useChainId();\n  const ethersSigner = useEthersSigner({ chainId });\n  const ethersReadonlyProvider = useEthersProvider({ chainId });\n\n  const sameChainRef = useRef((c: number | undefined) => c === chainId);\n  const sameSignerRef = useRef((s: any) => s?.address === address);\n\n  const [weightInput, setWeightInput] = useState<string>(\"\");\n  const [mounted, setMounted] = useState(false);\n\n  // Prevent hydration mismatch by only rendering after mount\n  useEffect(() => {\n    setMounted(true);\n  }, []);\n\n  // Get provider from wagmi\n  const publicClient = usePublicClient({ chainId });\n  const provider = useMemo(() => {\n    if (typeof window === \"undefined\") return undefined;\n    // Use window.ethereum if available, otherwise use wagmi's publicClient\n    if ((window as any).ethereum) {\n      return (window as any).ethereum;\n    }\n    return undefined;\n  }, []);\n\n  const {\n    instance: fhevmInstance,\n    status: fhevmStatus,\n    error: fhevmError,\n  } = useFhevm({\n    provider: provider,\n    chainId,\n    initialMockChains: { 31337: \"http://localhost:8545\" },\n    enabled: true,\n  });\n\n  const weightTrend = useWeightTrend({\n    instance: fhevmInstance,\n    fhevmDecryptionSignatureStorage,\n    chainId,\n    ethersSigner,\n    ethersReadonlyProvider,\n    sameChain: sameChainRef,\n    sameSigner: sameSignerRef,\n  });\n\n  const buttonClass =\n    \"inline-flex items-center justify-center rounded-xl bg-black px-4 py-4 font-semibold text-white shadow-sm \" +\n    \"transition-colors duration-200 hover:bg-blue-700 active:bg-blue-800 \" +\n    \"focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 \" +\n    \"disabled:opacity-50 disabled:pointer-events-none\";\n\n  const titleClass = \"font-semibold text-black text-lg mt-4\";\n\n  // Show consistent structure during SSR to prevent hydration mismatch\n  if (!mounted) {\n    return (\n      <div className=\"grid w-full gap-4\">\n        <div className=\"col-span-full mx-20 bg-black text-white rounded-lg p-5\">\n          <p className=\"font-semibold text-3xl m-5\">\n            Encrypted Weight Trend System\n          </p>\n          <p className=\"text-gray-300 ml-5\">\n            Loading...\n          </p>\n        </div>\n      </div>\n    );\n  }\n\n  if (!isConnected) {\n    return (\n      <div className=\"grid w-full gap-4\">\n        <div className=\"col-span-full mx-20 bg-black text-white rounded-lg p-5\">\n          <p className=\"text-2xl text-white mb-4\">Please connect your Rainbow wallet</p>\n          <p className=\"text-white\">Use the Connect button in the top right corner</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (weightTrend.isDeployed === false) {\n    return errorNotDeployed(chainId);\n  }\n\n  const handleSubmitWeight = () => {\n    const weight = parseFloat(weightInput);\n    if (weight > 0 && weight <= 1000) {\n      weightTrend.submitWeight(Math.round(weight * 10)); // Convert to integer (store as 0.1kg precision)\n      setWeightInput(\"\");\n    }\n  };\n\n  return (\n    <div className=\"grid w-full gap-4\">\n      <div className=\"col-span-full mx-20 bg-black text-white rounded-lg p-5\">\n        <p className=\"font-semibold text-3xl m-5\">\n          Encrypted Weight Trend System\n        </p>\n        <p className=\"text-gray-300 ml-5\">\n          Track your daily weight changes with fully homomorphic encryption\n        </p>\n      </div>\n\n      <div className=\"col-span-full mx-20 mt-4 px-5 pb-4 rounded-lg bg-white border-2 border-black\">\n        <p className={titleClass}>Chain Info</p>\n        <p className=\"text-black\">\n          ChainId: <span className=\"font-mono font-semibold\">{chainId}</span>\n        </p>\n        <p className=\"text-black\">\n          Account: <span className=\"font-mono font-semibold\">{address}</span>\n        </p>\n        <p className={titleClass}>Contract</p>\n        <p className=\"text-black\">\n          WeightTrend: <span className=\"font-mono font-semibold\">{weightTrend.contractAddress || \"Not deployed\"}</span>\n        </p>\n        <p className=\"text-black\">\n          isDeployed: <span className=\"font-mono font-semibold text-green-500\">{String(weightTrend.isDeployed)}</span>\n        </p>\n      </div>\n\n      <div className=\"col-span-full mx-20\">\n        <div className=\"grid grid-cols-2 gap-4\">\n          <div className=\"rounded-lg bg-white border-2 border-black pb-4 px-4\">\n            <p className={titleClass}>FHEVM Instance</p>\n            <p className=\"text-black\">\n              Fhevm Instance: <span className=\"font-mono font-semibold\">{fhevmInstance ? \"OK\" : \"undefined\"}</span>\n            </p>\n            <p className=\"text-black\">\n              Fhevm Status: <span className=\"font-mono font-semibold\">{fhevmStatus}</span>\n            </p>\n            <p className=\"text-black\">\n              Fhevm Error: <span className={`font-mono font-semibold ${fhevmError ? \"text-red-600\" : \"text-green-600\"}`}>\n                {fhevmError ? getFriendlyErrorMessage(fhevmError) : \"No Error\"}\n              </span>\n            </p>\n            {fhevmError && fhevmStatus === \"error\" && (\n              <div className=\"mt-2 p-2 bg-yellow-50 border border-yellow-200 rounded text-sm text-yellow-800\">\n                <p className=\"font-semibold\">Tip:</p>\n                <p>If this is a network connection error, please ensure:</p>\n                <ul className=\"list-disc list-inside ml-2 mt-1\">\n                  <li>Hardhat node is running (run 'npx hardhat node')</li>\n                  <li>Network connection is normal</li>\n                  <li>Refresh the page and try again</li>\n                </ul>\n              </div>\n            )}\n          </div>\n          <div className=\"rounded-lg bg-white border-2 border-black pb-4 px-4\">\n            <p className={titleClass}>Status</p>\n            <p className=\"text-black\">\n              isRefreshing: <span className=\"font-mono font-semibold\">{String(weightTrend.isRefreshing)}</span>\n            </p>\n            <p className=\"text-black\">\n              isDecrypting: <span className=\"font-mono font-semibold\">{String(weightTrend.isDecrypting)}</span>\n            </p>\n            <p className=\"text-black\">\n              isSubmitting: <span className=\"font-mono font-semibold\">{String(weightTrend.isSubmitting)}</span>\n            </p>\n            <p className=\"text-black\">\n              isComparing: <span className=\"font-mono font-semibold\">{String(weightTrend.isComparing)}</span>\n            </p>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"col-span-full mx-20 px-4 pb-4 rounded-lg bg-white border-2 border-black\">\n        <p className={titleClass}>Submit Weight</p>\n        <div className=\"flex gap-4 mt-4\">\n          <input\n            type=\"number\"\n            value={weightInput}\n            onChange={(e) => setWeightInput(e.target.value)}\n            placeholder=\"Enter weight in kg (e.g., 70.5)\"\n            className=\"flex-1 px-4 py-2 border-2 border-black rounded-lg\"\n            min=\"0\"\n            max=\"1000\"\n            step=\"0.1\"\n          />\n          <button\n            className={buttonClass}\n            disabled={!weightTrend.canSubmitWeight || !weightInput}\n            onClick={handleSubmitWeight}\n          >\n            {weightTrend.isSubmitting\n              ? \"Submitting...\"\n              : weightTrend.canSubmitWeight\n                ? \"Submit Weight\"\n                : \"Cannot submit\"}\n          </button>\n        </div>\n      </div>\n\n      <div className=\"col-span-full mx-20 px-4 pb-4 rounded-lg bg-white border-2 border-black\">\n        <p className={titleClass}>Today's Weight</p>\n        <p className=\"text-black\">\n          Weight Handle: <span className=\"font-mono font-semibold text-gray-600\">\n            {typeof weightTrend.todayWeightHandle === 'string' \n              ? weightTrend.todayWeightHandle \n              : weightTrend.todayWeightHandle \n                ? String(weightTrend.todayWeightHandle) \n                : \"Not set\"}\n          </span>\n        </p>\n        <p className=\"text-black\">\n          Clear Weight: <span className=\"font-mono font-semibold text-green-500\">\n            {weightTrend.isTodayWeightDecrypted\n              ? `${Number(weightTrend.clearTodayWeight) / 10} kg`\n              : \"Not decrypted\"}\n          </span>\n        </p>\n        <div className=\"flex gap-4 mt-4\">\n          <button\n            className={buttonClass}\n            disabled={!weightTrend.canGetTodayWeight}\n            onClick={weightTrend.refreshTodayWeight}\n          >\n            {weightTrend.canGetTodayWeight\n              ? \"Refresh Today's Weight\"\n              : \"Cannot refresh\"}\n          </button>\n          <button\n            className={buttonClass}\n            disabled={!weightTrend.canDecryptTodayWeight}\n            onClick={weightTrend.decryptTodayWeight}\n          >\n            {weightTrend.canDecryptTodayWeight\n              ? \"Decrypt Today's Weight\"\n              : weightTrend.isTodayWeightDecrypted\n                ? \"Already Decrypted\"\n                : weightTrend.isDecrypting\n                  ? \"Decrypting...\"\n                  : \"Nothing to decrypt\"}\n          </button>\n        </div>\n      </div>\n\n      <div className=\"col-span-full mx-20 px-4 pb-4 rounded-lg bg-white border-2 border-black\">\n        <p className={titleClass}>Weight Trend Comparison</p>\n        <p className=\"text-black\">\n          Trend Handle: <span className=\"font-mono font-semibold text-gray-600\">\n            {typeof weightTrend.trendHandle === 'string' \n              ? weightTrend.trendHandle \n              : weightTrend.trendHandle \n                ? String(weightTrend.trendHandle) \n                : \"Not compared\"}\n          </span>\n        </p>\n        <p className=\"text-black\">\n          Trend Result: <span className=\"font-mono font-semibold text-green-500\">\n            {weightTrend.isTrendDecrypted\n              ? weightTrend.clearTrend\n                ? \" Weight Decreased!\"\n                : \" Weight Increased or Same\"\n              : \"Not decrypted\"}\n          </span>\n        </p>\n        <div className=\"flex gap-4 mt-4\">\n          <button\n            className={buttonClass}\n            disabled={!weightTrend.canCompareTrend}\n            onClick={weightTrend.compareTrend}\n          >\n            {weightTrend.canCompareTrend\n              ? \"Compare Trend\"\n              : weightTrend.isComparing\n                ? \"Comparing...\"\n                : \"Cannot compare\"}\n          </button>\n          <button\n            className={buttonClass}\n            disabled={!weightTrend.canDecryptTrend}\n            onClick={weightTrend.decryptTrend}\n          >\n            {weightTrend.canDecryptTrend\n              ? \"Decrypt Trend\"\n              : weightTrend.isTrendDecrypted\n                ? \"Already Decrypted\"\n                : weightTrend.isDecrypting\n                  ? \"Decrypting...\"\n                  : \"Nothing to decrypt\"}\n          </button>\n        </div>\n      </div>\n\n      <div className=\"col-span-full mx-20 p-4 rounded-lg bg-white border-2 border-black\">\n        <p className={titleClass}>Message</p>\n        <p className=\"text-black font-mono\">\n          {typeof weightTrend.message === 'string' \n            ? weightTrend.message \n            : weightTrend.message \n              ? String(weightTrend.message) \n              : \"Ready\"}\n        </p>\n      </div>\n    </div>\n  );\n};\n\n"],"names":[],"mappings":"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","debugId":null}}]
}